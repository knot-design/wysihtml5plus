var wysihtml5={version:"0.5.8",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},classes:{},language:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};!function(e,t){"function"==typeof define&&define.amd?(window.rangy=e(),define("rangy",e)):t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n===v||!(n!==y||!e[t])||"unknown"===n}function t(e,t){return!(typeof e[t]!==y||!e[t])}function n(e,t){return typeof e[t]!==w}function i(e){return function(t,n){for(var i=n.length;i--;)if(!e(t,n[i]))return!1;return!0}}function o(e){return e&&x(e,E)&&T(e,N)}function r(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function s(n){t(window,"console")&&e(window.console,"log")&&window.console.log(n)}function a(e,t){t?window.alert(e):s(e)}function l(e){A.initialized=!0,A.supported=!1,a("Rangy is not supported on this page in your browser. Reason: "+e,A.config.alertOnFail)}function c(e){a("Rangy warning: "+e,A.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function u(){if(!A.initialized){var t,n=!1,i=!1;e(document,"createRange")&&(t=document.createRange(),x(t,C)&&T(t,b)&&(n=!0));var a=r(document);if(!a||"body"!=a.nodeName.toLowerCase())return void l("No body element found");if(a&&e(a,"createTextRange")&&(t=a.createTextRange(),o(t)&&(i=!0)),!n&&!i)return void l("Neither Range nor TextRange are available");A.initialized=!0,A.features={implementsDomRange:n,implementsTextRange:i};var c,u;for(var h in R)(c=R[h])instanceof f&&c.init(c,A);for(var m=0,g=k.length;g>m;++m)try{k[m](A)}catch(p){u="Rangy init listener threw an exception. Continuing. Detail: "+d(p),s(u)}}}function h(e){e=e||window,u();for(var t=0,n=L.length;n>t;++t)L[t](e)}function f(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n,i){var o=new f(t,n,function(e){if(!e.initialized){e.initialized=!0;try{i(A,e),e.supported=!0}catch(n){var o="Module '"+t+"' failed to load: "+d(n);s(o)}}});R[t]=o}function g(){}function p(){}var y="object",v="function",w="undefined",b=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],C=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],N=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],E=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],x=i(e),S=i(t),T=i(n),R={},A={version:"1.3.1",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:x,areHostObjects:S,areHostProperties:T,isTextRange:o,getBody:r},features:{},modules:R,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize===w?!0:rangyAutoInitialize}};A.fail=l,A.warn=c,{}.hasOwnProperty?A.util.extend=function(e,t,n){var i,o;for(var r in t)t.hasOwnProperty(r)&&(i=e[r],o=t[r],n&&null!==i&&"object"==typeof i&&null!==o&&"object"==typeof o&&A.util.extend(i,o,!0),e[r]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e}:l("hasOwnProperty not supported"),function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(i){}t||(t=function(e){for(var t=[],n=0,i=e.length;i>n;++n)t[n]=e[n];return t}),A.util.toArray=t}();var _;e(document,"addEventListener")?_=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?_=function(e,t,n){e.attachEvent("on"+t,n)}:l("Document does not have required addEventListener or attachEvent method"),A.util.addListener=_;var k=[];A.init=u,A.addInitListener=function(e){A.initialized?e(A):k.push(e)};var L=[];A.addShimListener=function(e){L.push(e)},A.shim=A.createMissingNativeApi=h,f.prototype={init:function(){for(var e,t,n=this.dependencies||[],i=0,o=n.length;o>i;++i){if(t=n[i],e=R[t],!(e&&e instanceof f))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){A.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){A.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},A.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var i=m(!1,e,n,t);A.initialized&&i.init()},A.createCoreModule=function(e,t,n){m(!0,e,t,n)},A.RangePrototype=g,A.rangePrototype=new g,A.selectionPrototype=new p;var I=!1,O=function(){I||(I=!0,!A.initialized&&A.config.autoInitialize&&u())};return typeof window==w?void l("No window found"):typeof document==w?void l("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",O,!1),_(window,"load",O),A.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==_||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function i(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function r(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function s(e,t){var n,i=[];for(n=e;n;n=n.parentNode)i.push(n);for(n=t;n;n=n.parentNode)if(O(i,n))return n;return null}function a(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function l(e,t){return a(e,t,!0)}function c(e,t,n){for(var i,o=n?e:e.parentNode;o;){if(i=o.parentNode,i===t)return o;o=i}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function h(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function f(e,t,n){var i=e.cloneNode(!1);if(i.deleteData(0,t),e.deleteData(t,e.length-t),h(i,e),n)for(var r,s=0;r=n[s++];)r.node==e&&r.offset>t?(r.node=i,r.offset-=t):r.node==e.parentNode&&r.offset>o(e)&&++r.offset;return i}function m(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=_)return e.ownerDocument;if(typeof e.document!=_)return e.document;if(e.parentNode)return m(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var n=m(e);if(typeof n.defaultView!=_)return n.defaultView;if(typeof n.parentWindow!=_)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=_)return e.contentDocument;if(typeof e.contentWindow!=_)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function y(e){if(typeof e.contentWindow!=_)return e.contentWindow;if(typeof e.contentDocument!=_)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function v(e){return e&&k.isHostMethod(e,"setTimeout")&&k.isHostObject(e,"document")}function w(e,t,n){var i;if(e?k.isHostProperty(e,"nodeType")?i=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?p(e):m(e):v(e)&&(i=e.document):i=document,!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function b(e){for(var t;t=e.parentNode;)e=t;return e}function C(e,n,i,r){var a,l,d,u,h;if(e==i)return n===r?0:r>n?-1:1;if(a=c(i,e,!0))return n<=o(a)?-1:1;if(a=c(e,i,!0))return o(a)<r?-1:1;if(l=s(e,i),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(d=e===l?l:c(e,l,!0),u=i===l?l:c(i,l,!0),d===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=l.firstChild;h;){if(h===d)return-1;if(h===u)return 1;h=h.nextSibling}}function N(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function E(e){if(!e)return"[No node]";if(D&&N(e))return"[Broken node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function x(e){for(var t,n=m(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function S(e){this.root=e,this._next=e}function T(e){return new S(e)}function R(e,t){this.node=e,this.offset=t}function A(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var _="undefined",k=e.util;k.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),k.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var L=document.createElement("div");k.areHostMethods(L,["insertBefore","appendChild","cloneNode"]||!k.areHostObjects(L,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),k.isHostProperty(L,"innerHTML")||t.fail("Element is missing innerHTML property");var I=document.createTextNode("test");k.areHostMethods(I,["splitText","deleteData","insertData","appendData","cloneNode"]||!k.areHostObjects(L,["previousSibling","nextSibling","childNodes","parentNode"])||!k.areHostProperties(I,["data"]))||t.fail("Incomplete Text Node implementation");var O=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},D=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",D=N(n),e.features.crashyTextNodes=D}();var M;typeof window.getComputedStyle!=_?M=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=_?M=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),S.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},R.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+E(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},A.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},A.prototype.toString=function(){return this.message},e.dom={arrayContains:O,isHtmlNamespace:n,parentElement:i,getNodeIndex:o,getNodeLength:r,getCommonAncestor:s,isAncestorOf:a,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:d,isTextOrCommentNode:u,insertAfter:h,splitDataNode:f,getDocument:m,getWindow:g,getIframeWindow:y,getIframeDocument:p,getBody:k.getBody,isWindow:v,getContentDocument:w,getRootContainer:b,comparePoints:C,isBrokenNode:N,inspectNode:E,getComputedStyleProperty:M,fragmentFromNodeChildren:x,createIterator:T,DomPosition:R},e.DOMException=A}),A.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(q(e,t.startContainer)||q(e,t.endContainer))}function n(e){return e.document||j(e.startContainer)}function i(e){return new P(e.parentNode,z(e))}function o(e){return new P(e.parentNode,z(e)+1)}function r(e,t,n){var i=11==e.nodeType?e.firstChild:e;return H(t)?n==t.length?D.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:U(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),i}function s(e,t,i){if(x(e),x(t),n(t)!=n(e))throw new B("WRONG_DOCUMENT_ERR");var o=W(e.startContainer,e.startOffset,t.endContainer,t.endOffset),r=W(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return i?0>=o&&r>=0:0>o&&r>0}function a(e){for(var t,i,o,r=n(e.range).createDocumentFragment();i=e.next();){if(t=e.isPartiallySelectedSubtree(),i=i.cloneNode(!t),t&&(o=e.getSubtreeIterator(),i.appendChild(a(o)),o.detach()),10==i.nodeType)throw new B("HIERARCHY_REQUEST_ERR");r.appendChild(i)}return r}function l(e,t,n){var i,o;n=n||{stop:!1};for(var r,s;r=e.next();)if(e.isPartiallySelectedSubtree()){if(t(r)===!1)return void(n.stop=!0);if(s=e.getSubtreeIterator(),l(s,t,n),s.detach(),n.stop)return}else for(i=D.createIterator(r);o=i.next();)if(t(o)===!1)return void(n.stop=!0)}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach()):e.remove()}function d(e){for(var t,i,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(d(i)),i.detach()):e.remove(),10==t.nodeType)throw new B("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function u(e,t,n){var i,o=!(!t||!t.length),r=!!n;o&&(i=new RegExp("^("+t.join("|")+")$"));var s=[];return l(new f(e,!1),function(t){if((!o||i.test(t.nodeType))&&(!r||n(t))){var a=e.startContainer;if(t!=a||!H(a)||e.startOffset!=a.length){var l=e.endContainer;t==l&&H(l)&&0==e.endOffset||s.push(t)}}}),s}function h(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+D.inspectNode(e.startContainer)+":"+e.startOffset+", "+D.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function f(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&H(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||H(this.sc)?V(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||H(this.ec)?V(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){return function(t,n){for(var i,o=n?t:t.parentNode;o;){if(i=o.nodeType,X(e,i))return o;o=o.parentNode}return null}}function g(e,t){if(ne(e,t))throw new B("INVALID_NODE_TYPE_ERR")}function p(e,t){if(!X(t,e.nodeType))throw new B("INVALID_NODE_TYPE_ERR")}function y(e,t){if(0>t||t>(H(e)?e.length:e.childNodes.length))throw new B("INDEX_SIZE_ERR")}function v(e,t){if(ee(e,!0)!==ee(t,!0))throw new B("WRONG_DOCUMENT_ERR")}function w(e){if(te(e,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR")}function b(e,t){if(!e)throw new B(t)}function C(e){return $&&D.isBrokenNode(e)||!X(Y,e.nodeType)&&!ee(e,!0)}function N(e,t){return t<=(H(e)?e.length:e.childNodes.length)}function E(e){return!!e.startContainer&&!!e.endContainer&&!C(e.startContainer)&&!C(e.endContainer)&&N(e.startContainer,e.startOffset)&&N(e.endContainer,e.endOffset)}function x(e){if(!E(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function S(e,t){x(e);var n=e.startContainer,i=e.startOffset,o=e.endContainer,r=e.endOffset,s=n===o;H(o)&&r>0&&r<o.length&&U(o,r,t),H(n)&&i>0&&i<n.length&&(n=U(n,i,t),s?(r-=i,o=n):o==n.parentNode&&r>=z(n)&&r++,i=0),e.setStartAndEnd(n,i,o,r)}function T(e){x(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function R(e){e.START_TO_START=le,e.START_TO_END=ce,e.END_TO_END=de,e.END_TO_START=ue,e.NODE_BEFORE=he,e.NODE_AFTER=fe,e.NODE_BEFORE_AND_AFTER=me,e.NODE_INSIDE=ge}function A(e){R(e),R(e.prototype)}function _(e,t){return function(){x(this);var n,i,r=this.startContainer,s=this.startOffset,a=this.commonAncestorContainer,c=new f(this,!0);r!==a&&(n=V(r,a,!0),i=o(n),r=i.node,s=i.offset),l(c,w),c.reset();var d=e(c);return c.detach(),t(this,r,s,r,s),d}}function k(n,r){function s(e,t){return function(n){p(n,K),p(G(n),Y);var r=(e?i:o)(n);(t?a:l)(this,r.node,r.offset)}}function a(e,t,n){var i=e.endContainer,o=e.endOffset;t===e.startContainer&&n===e.startOffset||(G(t)==G(i)&&1!=W(t,n,i,o)||(i=t,o=n),r(e,t,n,i,o))}function l(e,t,n){var i=e.startContainer,o=e.startOffset;t===e.endContainer&&n===e.endOffset||(G(t)==G(i)&&-1!=W(t,n,i,o)||(i=t,o=n),r(e,i,o,t,n))}var u=function(){};u.prototype=e.rangePrototype,n.prototype=new u,M.extend(n.prototype,{setStart:function(e,t){g(e,!0),y(e,t),a(this,e,t)},setEnd:function(e,t){g(e,!0),y(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],i=t,o=n;switch(e.length){case 3:o=e[2];break;case 4:i=e[2],o=e[3]}r(this,t,n,i,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){x(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){g(e,!0),r(this,e,0,e,F(e))},selectNode:function(e){g(e,!1),p(e,K);var t=i(e),n=o(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:_(d,r),deleteContents:_(c,r),canSurroundContents:function(){x(this),w(this.startContainer),w(this.endContainer);var e=new f(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},splitBoundaries:function(){S(this)},splitBoundariesPreservingPositions:function(e){S(this,e)},normalizeBoundaries:function(){x(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},s=function(o){var r=o.previousSibling;if(r&&r.nodeType==o.nodeType){e=o;var s=o.length;if(t=r.length,o.insertData(0,r.data),r.parentNode.removeChild(r),e==n)i+=t,n=e;else if(n==o.parentNode){var a=z(o);i==a?(n=o,i=s):i>a&&i--}}},a=!0;if(H(n))n.length==i&&o(n);else{if(i>0){var l=n.childNodes[i-1];l&&H(l)&&o(l)}a=!this.collapsed}if(a){if(H(e))0==t&&s(e);else if(t<e.childNodes.length){var c=e.childNodes[t];c&&H(c)&&s(c)}}else e=n,t=i;r(this,e,t,n,i)},collapseToPoint:function(e,t){g(e,!0),y(e,t),this.setStartAndEnd(e,t)}}),A(n)}function L(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:D.getCommonAncestor(e.startContainer,e.endContainer)}function I(e,t,n,i,o){e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=o,e.document=D.getDocument(t),L(e)}function O(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,L(this)}var D=e.dom,M=e.util,P=D.DomPosition,B=e.DOMException,H=D.isCharacterDataNode,z=D.getNodeIndex,q=D.isOrIsAncestorOf,j=D.getDocument,W=D.comparePoints,U=D.splitDataNode,V=D.getClosestAncestorIn,F=D.getNodeLength,X=D.arrayContains,G=D.getRootContainer,$=e.features.crashyTextNodes;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,H(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!H(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new O(n(this.range));var t=this._current,i=t,o=0,r=t,s=F(t);q(t,this.sc)&&(i=this.sc,o=this.so),q(t,this.ec)&&(r=this.ec,s=this.eo),I(e,i,o,r,s)}return new f(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var K=[1,3,4,5,7,8,10],Y=[2,9,11],Q=[5,6,10,12],J=[1,3,4,5,7,8,10,11],Z=[1,3,4,5,7,8],ee=m([9,11]),te=m(Q),ne=m([6,10,12]),ie=document.createElement("style"),oe=!1;try{ie.innerHTML="<b>x</b>",oe=3==ie.firstChild.nodeType}catch(re){}e.features.htmlParsingConforms=oe;var se=oe?function(e){var t=this.startContainer,n=j(t);if(!t)throw new B("INVALID_STATE_ERR");var i=null;return 1==t.nodeType?i=t:H(t)&&(i=D.parentElement(t)),i=null===i||"HTML"==i.nodeName&&D.isHtmlNamespace(j(i).documentElement)&&D.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=e,D.fragmentFromNodeChildren(i)}:function(e){var t=n(this),i=t.createElement("body");return i.innerHTML=e,D.fragmentFromNodeChildren(i)},ae=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],le=0,ce=1,de=2,ue=3,he=0,fe=1,me=2,ge=3;M.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){x(this),v(this.startContainer,t.startContainer);var n,i,o,r,s=e==ue||e==le?"start":"end",a=e==ce||e==le?"start":"end";return n=this[s+"Container"],i=this[s+"Offset"],o=t[a+"Container"],r=t[a+"Offset"],W(n,i,o,r)},insertNode:function(e){if(x(this),p(e,J),w(this.startContainer),q(e,this.startContainer))throw new B("HIERARCHY_REQUEST_ERR");var t=r(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){x(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&H(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var i=new f(this,!0);return e=a(i),i.detach(),e},canSurroundContents:function(){x(this),w(this.startContainer),w(this.endContainer);var e=new f(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(p(e,Z),!this.canSurroundContents())throw new B("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);r(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){x(this);for(var e,t=new O(n(this)),i=ae.length;i--;)e=ae[i],t[e]=this[e];return t},toString:function(){x(this);var e=this.startContainer;if(e===this.endContainer&&H(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new f(this,!0);return l(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){x(this);var t=e.parentNode,n=z(e);if(!t)throw new B("NOT_FOUND_ERR");var i=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>i?o>0?me:he:o>0?fe:ge},comparePoint:function(e,t){return x(this),b(e,"HIERARCHY_REQUEST_ERR"),v(e,this.startContainer),W(e,t,this.startContainer,this.startOffset)<0?-1:W(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:se,toHtml:function(){return T(this)},intersectsNode:function(e,t){if(x(this),b(e,"NOT_FOUND_ERR"),j(e)!==n(this))return!1;var i=e.parentNode,o=z(e);b(i,"NOT_FOUND_ERR");var r=W(i,o,this.endContainer,this.endOffset),s=W(i,o+1,this.startContainer,this.startOffset);return t?0>=r&&s>=0:0>r&&s>0},isPointInRange:function(e,t){return x(this),b(e,"HIERARCHY_REQUEST_ERR"),v(e,this.startContainer),W(e,t,this.startContainer,this.startOffset)>=0&&W(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return s(this,e,!1)},intersectsOrTouchesRange:function(e){return s(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=W(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=W(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==W(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==W(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new B("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ge},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,F(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var i=n.pop();return t.setEnd(i,i.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return x(this),u(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var i=n(this),o=e.createRange(i);t=t||D.getBody(i),o.selectNodeContents(t);var r=this.intersection(o),s=0,a=0;return r&&(o.setEnd(r.startContainer,r.startOffset),s=o.toString().length,a=s+r.toString().length),{start:s,end:a,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var i,o,r,s,a=[t],l=!1,c=!1;!c&&(i=a.pop());)if(3==i.nodeType)o=n+i.length,!l&&e.start>=n&&e.start<=o&&(this.setStart(i,e.start-n),l=!0),l&&e.end>=n&&e.end<=o&&(this.setEnd(i,e.end-n),c=!0),n=o;else for(s=i.childNodes,r=s.length;r--;)a.push(s[r])},getName:function(){return"DomRange"},equals:function(e){return O.rangesEqual(this,e)},isValid:function(){return E(this)},inspect:function(){return h(this)},detach:function(){}}),k(O,I),M.extend(O,{rangeProperties:ae,RangeIterator:f,copyComparisonConstants:A,createPrototypeRange:k,inspect:h,toHtml:T,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=O}),A.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,i,o=e.dom,r=e.util,s=o.DomPosition,a=e.DomRange,l=o.getBody,c=o.getContentDocument,d=o.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function i(e){for(var t,n=h.length;n--;)t=h[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function s(e,t,n,i,o){var r=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==i||e.endOffset!=o,a=!e.equals(e.nativeRange);(r||s||a)&&(e.setEnd(i,o),e.setStart(t,n))}var d,u,h=a.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,i(this)},a.createPrototypeRange(n,s),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),i(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),i(this)},d.collapse=function(e){this.nativeRange.collapse(e),i(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){i(this)},d.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");l(document).appendChild(f);var m=document.createRange();m.setStart(f,0),m.setEnd(f,0);try{m.setStart(f,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),i(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),i(this)},u=function(e){return function(t){this.nativeRange[e](t),i(this)}}}catch(g){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}i(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}i(this)},u=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}i(this)}}}d.setStartBefore=u("setStartBefore","setEndBefore"),d.setStartAfter=u("setStartAfter","setEndAfter"),d.setEndBefore=u("setEndBefore","setStartBefore"),d.setEndAfter=u("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},m.selectNodeContents(f),m.setEnd(f,3);var p=document.createRange();p.selectNodeContents(f),p.setEnd(f,4),p.setStart(f,2),-1==m.compareBoundaryPoints(m.START_TO_END,p)&&1==m.compareBoundaryPoints(m.END_TO_START,p)?d.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:d.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElement("div");y.innerHTML="123";var v=y.firstChild,w=l(document);w.appendChild(y),m.setStart(v,1),m.setEnd(v,2),m.deleteContents(),"13"==v.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),i(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return i(this),e}),w.removeChild(y),w=null,r.isHostMethod(m,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(f),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var r=n.parentElement(),s=i==r?i:o.getCommonAncestor(i,r);return s==t?s:o.getCommonAncestor(t,s)},h=function(e){return 0==e.compareEndPoints("StartToEnd",e)},f=function(e,t,n,i,r){var a=e.duplicate();a.collapse(n);var l=a.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new s(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var u=o.getDocument(l).createElement("span");u.parentNode&&u.parentNode.removeChild(u);for(var h,f,m,g,p,y=n?"StartToStart":"StartToEnd",v=r&&r.containerElement==l?r.nodeIndex:0,w=l.childNodes.length,b=w,C=b;;){if(C==w?l.appendChild(u):l.insertBefore(u,l.childNodes[C]),a.moveToElementText(u),h=a.compareEndPoints(y,e),0==h||v==b)break;if(-1==h){if(b==v+1)break;v=C}else b=b==v+1?v:C;C=Math.floor((v+b)/2),l.removeChild(u)}if(p=u.nextSibling,-1==h&&p&&d(p)){a.setEndPoint(n?"EndToStart":"EndToEnd",e);var N;if(/[\r\n]/.test(p.data)){var E=a.duplicate(),x=E.text.replace(/\r\n/g,"\r").length;for(N=E.moveStart("character",x);-1==(h=E.compareEndPoints("StartToEnd",E));)N++,E.moveStart("character",1)}else N=a.text.length;g=new s(p,N)}else f=(i||!n)&&u.previousSibling,m=(i||n)&&u.nextSibling,g=m&&d(m)?new s(m,0):f&&d(f)?new s(f,f.data.length):new s(l,o.getNodeIndex(u));return u.parentNode.removeChild(u),{boundaryPosition:g,nodeInfo:{nodeIndex:C,containerElement:l}}},m=function(e,t){var n,i,r,s,a=e.offset,c=o.getDocument(e.node),u=l(c).createTextRange(),h=d(e.node);return h?(n=e.node,i=n.parentNode):(s=e.node.childNodes,n=a<s.length?s[a]:null,i=e.node),r=c.createElement("span"),r.innerHTML="&#feff;",n?i.insertBefore(r,n):i.appendChild(r),u.moveToElementText(r),u.collapse(!t),i.removeChild(r),h&&u[t?"moveStart":"moveEnd"]("character",a),u};i=function(e){this.textRange=e,this.refresh()},i.prototype=new a(document),i.prototype.refresh=function(){var e,t,n,i=u(this.textRange);h(this.textRange)?t=e=f(this.textRange,i,!0,!0).boundaryPosition:(n=f(this.textRange,i,!0,!1),e=n.boundaryPosition,t=f(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},a.copyComparisonConstants(i);var g=function(e){if(e.collapsed)return m(new s(e.startContainer,e.startOffset),!0);var t=m(new s(e.startContainer,e.startOffset),!0),n=m(new s(e.endContainer,e.endOffset),!1),i=l(a.getRangeDocument(e)).createTextRange();
return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i};if(i.rangeToTextRange=g,i.prototype.toTextRange=function(){return g(this)},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var p=function(){return this}();"undefined"==typeof p.Range&&(p.Range=i),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new a(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),A.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function i(e,n){if(e){if(A.isWindow(e))return e;if(e instanceof y)return e.win;var i=A.getContentDocument(e,t,n);return A.getWindow(i)}return window}function o(e){return i(e,"getWinSelection").getSelection()}function r(e){return i(e,"getDocSelection").document.selection}function s(e){var t=!1;return e.anchorNode&&(t=1==A.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function a(e,t,n){var i=n?"end":"start",o=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof L?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof I?n=t.nativeRange:M.implementsDomRange&&t instanceof A.getWindow(t.startContainer).Range&&(n=t),n}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!A.isAncestorOf(e[0],e[t]))return!1;return!0}function h(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function f(e){return!!e&&"undefined"!=typeof e.text}function m(e,t){var n=new I(t);e._ranges=[n],a(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else{var n=t.docSelection.createRange();if(f(n))m(t,n);else{t.rangeCount=n.length;for(var i,o=B(n.item(0)),r=0;r<t.rangeCount;++r)i=e.createRange(o),i.selectNode(n.item(r)),t._ranges.push(i);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,a(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,n){for(var i=e.docSelection.createRange(),o=h(n),r=B(i.item(0)),s=H(r).createControlRange(),a=0,l=i.length;l>a;++a)s.add(i.item(a));try{s.add(o)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}s.select(),g(e)}function y(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function v(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function w(e,t){for(var n,i,o=te.length;o--;)if(n=te[o],i=n.selection,"deleteAll"==t)v(i);else if(n.win==e)return"delete"==t?(te.splice(o,1),!0):i;return"deleteAll"==t&&(te.length=0),null}function b(e,n){for(var i,o=B(n[0].startContainer),r=H(o).createControlRange(),s=0,a=n.length;a>s;++s){i=h(n[s]);try{r.add(i)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),g(e)}function C(e,t){if(e.win.document!=B(t))throw new O("WRONG_DOCUMENT_ERR")}function N(t){return function(n,i){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,i)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,i)),this.setSingleRange(o,this.isBackward())}}function E(e){var t=[],n=new D(e.anchorNode,e.anchorOffset),i=new D(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var r=0,s=e.rangeCount;s>r;++r)t[r]=L.inspect(e.getRangeAt(r));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}e.config.checkSelectionRanges=!0;var x,S,T="boolean",R="number",A=e.dom,_=e.util,k=_.isHostMethod,L=e.DomRange,I=e.WrappedRange,O=e.DOMException,D=A.DomPosition,M=e.features,P="Control",B=A.getDocument,H=A.getBody,z=L.rangesEqual,q=k(window,"getSelection"),j=_.isHostObject(document,"selection");M.implementsWinGetSelection=q,M.implementsDocSelection=j;var W=j&&(!q||e.config.preferTextRange);W?(x=r,e.isSelectionValid=function(e){var t=i(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||B(n.createRange().parentElement())==t}):q?(x=o,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=x;var U=x(),V=e.createNativeRange(document),F=H(document),X=_.areHostProperties(U,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=X;var G=k(U,"extend");M.selectionHasExtend=G;var $=typeof U.rangeCount==R;M.selectionHasRangeCount=$;var K=!1,Y=!0,Q=G?function(t,n){var i=L.getRangeDocument(n),o=e.createRange(i);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(d(o)),t.extend(n.startContainer,n.startOffset)}:null;_.areHostMethods(U,["addRange","getRangeAt","removeAllRanges"])&&typeof U.rangeCount==R&&M.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,i=n>1,o=[],r=s(t),a=0;n>a;++a)o[a]=t.getRangeAt(a);var l=H(document),c=l.appendChild(document.createElement("div"));c.contentEditable="false";var d=c.appendChild(document.createTextNode("   ")),u=document.createRange();if(u.setStart(d,1),u.collapse(!0),t.addRange(u),Y=1==t.rangeCount,t.removeAllRanges(),!i){var h=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(h&&parseInt(h[1])>=36)K=!1;else{var f=u.cloneRange();u.setStart(d,0),f.setEnd(d,3),f.setStart(d,2),t.addRange(u),t.addRange(f),K=2==t.rangeCount}}for(l.removeChild(c),t.removeAllRanges(),a=0;n>a;++a)0==a&&r?Q?Q(t,o[a]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[a])):t.addRange(o[a])}}(),M.selectionSupportsMultipleRanges=K,M.collapsedNonEditableSelectionsSupported=Y;var J,Z=!1;F&&k(F,"createControlRange")&&(J=F.createControlRange(),_.areHostProperties(J,["item","add"])&&(Z=!0)),M.implementsControlRange=Z,S=X?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;k(U,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:X&&(ee=function(t){var n=B(t.anchorNode),i=e.createRange(n);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),y.prototype=e.selectionPrototype;var te=[],ne=function(e){if(e&&e instanceof y)return e.refresh(),e;e=i(e,"getNativeSelection");var t=w(e),n=x(e),o=j?r(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new y(n,o,e),te.push({win:e,selection:t})),t};e.getSelection=ne,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(A.getIframeWindow(n))};var ie=y.prototype;if(!W&&X&&_.areHostMethods(U,["removeAllRanges","addRange"])){ie.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var oe=function(e,t){Q(e.nativeSelection,t),e.refresh()};$?ie.addRange=function(t,i){if(Z&&j&&this.docSelection.type==P)p(this,t);else if(n(i)&&G)oe(this,t);else{var o;if(K?o=this.rangeCount:(this.removeAllRanges(),o=0),this.nativeSelection.addRange(d(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var r=ee(this.nativeSelection,this.rangeCount-1);r&&!z(r,t)&&(t=new I(r))}this._ranges[this.rangeCount-1]=t,a(this,t,ae(this.nativeSelection)),this.isCollapsed=S(this)}else this.refresh()}}:ie.addRange=function(e,t){n(t)&&G?oe(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},ie.setRanges=function(e){if(Z&&j&&e.length>1)b(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(k(U,"empty")&&k(V,"select")&&Z&&W))return t.fail("No means of selecting a Range or TextRange was found"),!1;ie.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=B(this.anchorNode);else if(this.docSelection.type==P){var t=this.docSelection.createRange();t.length&&(e=B(t.item(0)))}if(e){var n=H(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}c(this)},ie.addRange=function(t){this.docSelection.type==P?p(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,a(this,t,!1))},ie.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?b(this,e):t&&this.addRange(e[0])}}ie.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new O("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var re;if(W)re=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=H(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==P?g(t):f(n)?m(t,n):c(t)};else if(k(U,"getRangeAt")&&typeof U.rangeCount==R)re=function(t){if(Z&&j&&t.docSelection.type==P)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,i=t.rangeCount;i>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));a(t,t._ranges[t.rangeCount-1],ae(t.nativeSelection)),t.isCollapsed=S(t)}else c(t)};else{if(!X||typeof U.isCollapsed!=T||typeof V.collapsed!=T||!M.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;re=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=S(e)):c(e)}}ie.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(re(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;o--;)if(!z(t[o],this._ranges[o]))return!0;return!1}};var se=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var i=0,o=n.length;o>i;++i)z(t,n[i])||e.addRange(n[i]);e.rangeCount||c(e)};Z&&j?ie.removeRange=function(e){if(this.docSelection.type==P){for(var t,n=this.docSelection.createRange(),i=h(e),o=B(n.item(0)),r=H(o).createControlRange(),s=!1,a=0,l=n.length;l>a;++a)t=n.item(a),t!==i||s?r.add(n.item(a)):s=!0;r.select(),g(this)}else se(this,e)}:ie.removeRange=function(e){se(this,e)};var ae;!W&&X&&M.implementsDomRange?(ae=s,ie.isBackward=function(){return ae(this)}):ae=ie.isBackward=function(){return!1},ie.isBackwards=ie.isBackward,ie.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},ie.collapse=function(t,n){C(this,t);var i=e.createRange(t);i.collapseToPoint(t,n),this.setSingleRange(i),this.isCollapsed=!0},ie.collapseToStart=function(){if(!this.rangeCount)throw new O("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ie.collapseToEnd=function(){if(!this.rangeCount)throw new O("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ie.selectAllChildren=function(t){C(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},ie.deleteFromDocument=function(){if(Z&&j&&this.docSelection.type==P){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,o=n.length;o>i;++i)n[i].deleteContents();this.addRange(n[o-1])}}},ie.eachRange=function(e,t){for(var n=0,i=this._ranges.length;i>n;++n)if(e(this.getRangeAt(n)))return t},ie.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ie.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ie.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(i){n.push(i[e].apply(i,t))}),n},ie.setStart=N(!0),ie.setEnd=N(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},ie.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ie.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},ie.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ie.moveToBookmark=function(t){for(var n,i,o=[],r=0;n=t.rangeBookmarks[r++];)i=e.createRange(this.win),i.moveToBookmark(n),o.push(i);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},ie.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(L.toHtml(t))}),e.join("")},M.implementsTextRange&&(ie.getNativeTextRange=function(){var n;if(n=this.docSelection){var i=n.createRange();if(f(i))return i;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ie.getName=function(){return"WrappedSelection"},ie.inspect=function(){return E(this)},ie.detach=function(){w(this.win,"delete"),v(this)},y.detachAll=function(){w(null,"deleteAll")},y.inspect=E,y.isDirectionBackward=n,e.Selection=y,e.selectionPrototype=ie,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})}),A)},this),function(e,t){"function"==typeof define&&define.amd?(e(window.rangy),define(["rangy"],e)):e(t.rangy)}(function(e){e.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function i(e,t){var n,i="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=m.getDocument(e.startContainer),r=e.cloneRange();return r.collapse(t),n=o.createElement("span"),n.id=i,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(o.createTextNode(g)),r.insertNode(n),n}function o(e,i,o,r){var s=n(o,e);s?(i[r?"setStartBefore":"setEndBefore"](s),s.parentNode.removeChild(s)):t.warn("Marker element has been removed. Cannot restore selection.")}function r(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function s(t,n){var o,r,s=e.DomRange.getRangeDocument(t),a=t.toString();return t.collapsed?(r=i(t,!1),{document:s,markerId:r.id,collapsed:!0}):(r=i(t,!1),o=i(t,!0),{document:s,startMarkerId:o.id,endMarkerId:r.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+a+"', new text: '"+t.toString()+"'"}})}function a(i,r){var s=i.document;"undefined"==typeof r&&(r=!0);var a=e.createRange(s);if(i.collapsed){var l=n(i.markerId,s);if(l){l.style.display="inline";var c=l.previousSibling;c&&3==c.nodeType?(l.parentNode.removeChild(l),a.collapseToPoint(c,c.length)):(a.collapseBefore(l),l.parentNode.removeChild(l))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(s,a,i.startMarkerId,!0),o(s,a,i.endMarkerId,!1);return r&&a.normalizeBoundaries(),a}function l(t,i){var o,a,l=[];t=t.slice(0),t.sort(r);for(var c=0,d=t.length;d>c;++c)l[c]=s(t[c],i);for(c=d-1;c>=0;--c)o=t[c],a=e.DomRange.getRangeDocument(o),o.collapsed?o.collapseAfter(n(l[c].markerId,a)):(o.setEndBefore(n(l[c].endMarkerId,a)),o.setStartAfter(n(l[c].startMarkerId,a)));return l}function c(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var i=e.getSelection(n),o=i.getAllRanges(),r=1==o.length&&i.isBackward(),s=l(o,r);return r?i.setSingleRange(o[0],"backward"):i.setRanges(o),{win:n,rangeInfos:s,restored:!1}}function d(e){for(var t=[],n=e.length,i=n-1;i>=0;i--)t[i]=a(e[i],!0);return t}function u(t,n){if(!t.restored){var i=t.rangeInfos,o=e.getSelection(t.win),r=d(i),s=i.length;1==s&&n&&e.features.selectionHasExtend&&i[0].backward?(o.removeAllRanges(),o.addRange(r[0],!0)):o.setRanges(r),t.restored=!0}}function h(e,t){var i=n(t,e);i&&i.parentNode.removeChild(i)}function f(e){for(var t,n=e.rangeInfos,i=0,o=n.length;o>i;++i)t=n[i],t.collapsed?h(e.doc,t.markerId):(h(e.doc,t.startMarkerId),h(e.doc,t.endMarkerId))}var m=e.dom,g="\ufeff";e.util.extend(e,{saveRange:s,restoreRange:a,saveRanges:l,restoreRanges:d,saveSelection:c,restoreSelection:u,removeMarkerElement:h,removeMarkers:f})})},this);var Base=function(){};Base.extend=function(e,t){var n=Base.prototype.extend;Base._prototyping=!0;var i=new this;n.call(i,e),i.base=function(){},delete Base._prototyping;var o=i.constructor,r=i.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==r)this._constructing=!0,o.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||n).call(arguments[0],i)};return r.ancestor=this,r.extend=this.extend,r.forEach=this.forEach,r.implement=this.implement,r.prototype=i,r.toString=this.toString,r.valueOf=function(e){return"object"==e?r:o.valueOf()},n.call(r,t),"function"==typeof r.init&&r.init(),r},Base.prototype={extend:function(e,t){if(arguments.length>1){var n=this[e];if(n&&"function"==typeof t&&(!n.valueOf||n.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var i=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=n;var t=i.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return"object"==e?t:i},t.toString=Base.toString}this[e]=t}else if(e){var o=Base.prototype.extend;Base._prototyping||"function"==typeof this||(o=this.extend||o);for(var r={toSource:null},s=["constructor","toString","valueOf"],a=Base._prototyping?0:1;l=s[a++];)e[l]!=r[l]&&o.call(this,l,e[l]);for(var l in e)r[l]||o.call(this,l,e[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var i in e)void 0===this.prototype[i]&&t.call(n,e[i],i,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function e(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function t(e){return+(e.match(/android (\d+)/)||[void 0,0])[1]}function n(e,t){var n,i=-1;return"Microsoft Internet Explorer"==navigator.appName?n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(n=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),n&&null!=n.exec(navigator.userAgent)&&(i=parseFloat(RegExp.$1)),-1===i?!1:e?t?"<"===t?i>e:">"===t?e>i:"<="===t?i>=e:">="===t?e>=i:void 0:e===i:!0}var i=navigator.userAgent,o=document.createElement("div"),r=-1!==i.indexOf("Gecko")&&-1===i.indexOf("KHTML"),s=-1!==i.indexOf("AppleWebKit/"),a=-1!==i.indexOf("Chrome/"),l=-1!==i.indexOf("Opera/");return{USER_AGENT:i,supported:function(){var n=this.USER_AGENT.toLowerCase(),i="contentEditable"in o,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,s=document.querySelector&&document.querySelectorAll,a=this.isIos()&&e(n)<5||this.isAndroid()&&t(n)<4||-1!==n.indexOf("opera mobi")||-1!==n.indexOf("hpwos/");return i&&r&&s&&!a},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return n()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return n()},hasCurrentStyleProperty:function(){return"currentStyle"in o},hasHistoryIssue:function(){return r&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in o||function(){return o.setAttribute("on"+e,"return;"),"function"==typeof o["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!l},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:function(){var e={formatBlock:n(10,"<="),insertUnorderedList:n(),insertOrderedList:n()},t={insertHTML:r};return function(n,i){var o=e[i];if(!o){try{return n.queryCommandSupported(i)}catch(r){}try{return n.queryCommandEnabled(i)}catch(s){return!!t[i]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||l||s},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||n()||l},autoScrollsToCaret:function(){return!s},autoClosesUnclosedTags:function(){var e,t,n=o.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return l},supportsSpeechApiOn:function(e){var t=i.match(/Chrome\/(\d+)/)||[void 0,0];return t[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return n(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return n()},hasProblemsSettingCaretAfterImg:function(){return n()},hasUndoInContextMenu:function(){return r||a||l},hasInsertNodeIssue:function(){return l},hasIframeFocusIssue:function(){return n()},createsNestedInvalidMarkupAfterPaste:function(){return s},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(Array.isArray(t)){for(var n=t.length;n--;)if(-1!==wysihtml5.lang.array(e).indexOf(t[n]))return!0;return!1}return-1!==wysihtml5.lang.array(e).indexOf(t)},indexOf:function(t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},without:function(t){t=wysihtml5.lang.array(t);for(var n=[],i=0,o=e.length;o>i;i++)t.contains(e[i])||n.push(e[i]);return n},get:function(){for(var t=0,n=e.length,i=[];n>t;t++)i.push(e[t]);return i},map:function(t,n){if(Array.prototype.map)return e.map(t,n);for(var i=e.length>>>0,o=new Array(i),r=0;i>r;r++)o[r]=t.call(n,e[r],r,e);return o},unique:function(){for(var t=[],n=e.length,i=0;n>i;)wysihtml5.lang.array(t).contains(e[i])||t.push(e[i]),i++;return t}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,i,o=0;if(e){for(n=this.events[e]||[],i=[];o<n.length;o++)n[o]!==t&&t&&i.push(n[o]);this.events[e]=i}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],i=0;i<n.length;i++)n[i].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(t){var n,i={};if(null===e||!wysihtml5.lang.object(e).isPlainObject())return e;for(n in e)e.hasOwnProperty(n)&&(t?i[n]=wysihtml5.lang.object(e[n]).clone(t):i[n]=e[n]);return i},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(e)},isPlainObject:function(){return"[object Object]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/,n=/[&<>\t"]/g,i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(o){return o=String(o),{trim:function(){return o.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)o=this.replace("#{"+t+"}").by(e[t]);return o},replace:function(e){return{by:function(t){return o.split(e).join(t)}}},escapeHTML:function(e,t){var r=o.replace(n,function(e){return i[e]});return e&&(r=r.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(r=r.replace(/  /gi,"&nbsp; ")),r}}}}(),function(e){function t(e,t){return r(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),s(e,t))}function n(e){return e.replace(l,function(e,t){var n=(t.match(c)||[])[1]||"",i=u[n];t=t.replace(c,""),t.split(i).length>t.split(n).length&&(t+=n,n="");var o=t,r=t;return t.length>d&&(r=r.substr(0,d)+"..."),"www."===o.substr(0,4)&&(o="http://"+o),'<a href="'+o+'">'+r+"</a>"+n})}function i(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function o(t){var o=t.parentNode,r=e.lang.string(t.data).escapeHTML(),s=i(o.ownerDocument);for(s.innerHTML="<span></span>"+n(r),s.removeChild(s.firstChild);s.firstChild;)o.insertBefore(s.firstChild,t);o.removeChild(t)}function r(t,n){for(var i;t.parentNode;){if(t=t.parentNode,i=t.nodeName,t.className&&e.lang.array(t.className.split(" ")).contains(n))return!0;if(a.contains(i))return!0;if("body"===i)return!1}return!1}function s(t,n){if(!(a.contains(t.nodeName)||t.className&&e.lang.array(t.className.split(" ")).contains(n))){if(t.nodeType===e.TEXT_NODE&&t.data.match(l))return void o(t);for(var i=e.lang.array(t.childNodes).get(),r=i.length,c=0;r>c;c++)s(i[c],n);return t}}var a=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,c=/([^\w\/\-](,?))$/i,d=100,u={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=l}(wysihtml5),function(e){var t=e.dom;t.addClass=function(e,n){var i=e.classList;return i?i.add(n):void(t.hasClass(e,n)||(e.className+=" "+n))},t.removeClass=function(e,t){var n=e.classList;return n?n.remove(t):void(e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))},t.hasClass=function(e,t){var n=e.classList;if(n)return n.contains(t);var i=e.className;return i.length>0&&(i==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(i))},t.toggleClass=function(e,n){if(e.classList)return e.classList.toggle(n);var i=t.hasClass(e,n),o=(i?"remove":"add")+"Class";o&&t[o](e,n)},t.getBlockParentNode=function(e){for(var t,n=["H1","H2","H3","H4","H5","H6","P","PRE","BLOQUATE","FIGURE","DIV"];e;){if(t=e.parentNode,t&&n.indexOf(t.tagName)>=0)return t;e=t}return null},t.closest=function(e,t){if(window.Element&&!Element.prototype.closest){var n,i;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(t){return"function"==typeof e[t]?(n=t,!0):!1});e;){if(i=e.parentElement,i&&i[n](t))return i;e=i}return null}return e.closest(t)}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}function t(e,t){return e.createElement(t)}function n(n,i,o){if("UL"===n.nodeName||"OL"===n.nodeName||"MENU"===n.nodeName)return n;var r,s,a,l,c,d,u,h,f,m=n.ownerDocument,g=t(m,i),p=n.querySelectorAll("br"),y=p.length;for(f=0;y>f;f++)for(l=p[f];(c=l.parentNode)&&c!==n&&c.lastChild===l;){if("block"===wysihtml5.dom.getStyle("display").from(c)){c.removeChild(l);break}wysihtml5.dom.insert(l).after(l.parentNode)}for(r=wysihtml5.lang.array(n.childNodes).get(),s=r.length,f=0;s>f;f++)h=h||e(m,g),a=r[f],d="block"===wysihtml5.dom.getStyle("display").from(a),u="BR"===a.nodeName,!d||o&&wysihtml5.dom.hasClass(a,o)?u?h=h.firstChild?null:h:h.appendChild(a):(h=h.firstChild?e(m,g):h,h.appendChild(a),h=null);return 0===r.length&&e(m,g),n.parentNode.replaceChild(g,n),g}return n}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var i,o=0,r=e.length;r>o;o++)i=e[o],"undefined"!=typeof t[i]&&""!==t[i]&&(n[i]=t[i]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(t){return i(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},i=function(n){for(var i=0,o=t.length;o>i;i++)if("border-box"===e.getStyle(t[i]).from(n))return t[i]};e.copyStyles=function(i){return{from:function(o){n(o)&&(i=wysihtml5.lang.array(i).without(t));for(var r,s="",a=i.length,l=0;a>l;l++)r=i[l],s+=r+":"+e.getStyle(r).from(o)+";";return{to:function(t){return e.setStyles(s).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,n,i,o){return e.dom.observe(t,i,function(i){for(var r=i.target,s=e.lang.array(t.querySelectorAll(n));r&&r!==t;){if(s.contains(r)){o.call(r,i);break}r=r.parentNode}})}}(wysihtml5),function(e){e.dom.domNode=function(t){var n=[e.ELEMENT_NODE,e.TEXT_NODE],i=function(t){return t.nodeType===e.TEXT_NODE&&/^\s*$/g.test(t.data)};return{prev:function(o){var r=t.previousSibling,s=o&&o.nodeTypes?o.nodeTypes:n;return r?!e.lang.array(s).contains(r.nodeType)||o&&o.ignoreBlankTexts&&i(r)?e.dom.domNode(r).prev(o):r:null},next:function(o){var r=t.nextSibling,s=o&&o.nodeTypes?o.nodeTypes:n;return r?!e.lang.array(s).contains(r.nodeType)||o&&o.ignoreBlankTexts&&i(r)?e.dom.domNode(r).next(o):r:null}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(i){}return t.body.removeChild(n),n},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,i=n.length;i>t;t++)e.createElement(n[t]);e._wysihtml5_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,i){i=i||document;var o;return"object"==typeof n&&n.nodeType?(o=i.createElement("div"),o.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(i)?(o=i.createElement("div"),o.innerHTML=n):(t(i),o=e(n,i)),o}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return t&&t.length?"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e):!0}function t(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function n(e,t,n){var i=(e.className||"").match(n)||[];return t?i[i.length-1]===t:!!i.length}function i(e,t,n){var i=(e.getAttribute("style")||"").match(n)||[];return t?i[i.length-1]===t:!!i.length}return function(o,r,s,a){var l=r.cssStyle||r.styleRegExp,c=r.className||r.classRegExp;
for(s=s||50;s--&&o&&"BODY"!==o.nodeName&&(!a||o!==a);){if(t(o)&&e(o.nodeName,r.nodeName)&&(!l||i(o,r.cssStyle,r.styleRegExp))&&(!c||n(o,r.className,r.classRegExp)))return o;o=o.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(n,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(i){if(i.nodeType===wysihtml5.ELEMENT_NODE){var o=i.ownerDocument,r=t[n]||e(n),s=i.style,a=i.currentStyle,l=s[r];if(l)return l;if(a)try{return a[r]}catch(c){}var d,u,h=o.defaultView||o.parentWindow,f=("height"===n||"width"===n)&&"TEXTAREA"===i.nodeName;return h.getComputedStyle?(f&&(d=s.overflow,s.overflow="hidden"),u=h.getComputedStyle(i,null).getPropertyValue(n),f&&(s.overflow=d||""),u):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(e,t){var n=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||n.push(e):n=n.concat(wysihtml5.dom.getTextNodes(e,t));return n},wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var t={},n=1;return function(n,i){var o=e(n)+":"+i,r=t[o];return r||(r=t[o]=n.getElementsByTagName(i)),r.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=i++)}var n={},i=1;e.dom.hasElementWithClassName=function(i,o){if(!e.browser.supportsNativeGetElementsByClassName())return!!i.querySelector("."+o);var r=t(i)+":"+o,s=n[r];return s||(s=n[r]=i.getElementsByClassName(o)),s.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e));var i=t.querySelector("head link");if(i)return void i.parentNode.insertBefore(n,i);var o=t.querySelector("head");o&&o.appendChild(n)}}},function(e){e.dom.lineBreaks=function(t){function n(e){return"BR"===e.nodeName}function i(t){return n(t)?!0:"block"===e.dom.getStyle("display").from(t)}return{add:function(){var n=t.ownerDocument,o=e.dom.domNode(t).next({ignoreBlankTexts:!0}),r=e.dom.domNode(t).prev({ignoreBlankTexts:!0});o&&!i(o)&&e.dom.insert(n.createElement("br")).after(t),r&&!i(r)&&e.dom.insert(n.createElement("br")).before(t)},remove:function(){var i=e.dom.domNode(t).next({ignoreBlankTexts:!0}),o=e.dom.domNode(t).prev({ignoreBlankTexts:!0});i&&n(i)&&i.parentNode.removeChild(i),o&&n(o)&&o.parentNode.removeChild(o)}}}}(wysihtml5),wysihtml5.dom.observe=function(e,t,n){t="string"==typeof t?[t]:t;for(var i,o,r=0,s=t.length;s>r;r++)o=t[r],e.addEventListener?e.addEventListener(o,n,!1):(i=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+o,i));return{stop:function(){for(var o,r=0,s=t.length;s>r;r++)o=t[r],e.removeEventListener?e.removeEventListener(o,n,!1):e.detachEvent("on"+o,i)}}},wysihtml5.dom.parse=function(e,t){function n(e,t){wysihtml5.lang.object(w).merge(v).merge(t.rules).get();var n,r,s,a=t.context||e.ownerDocument||document,l=a.createDocumentFragment(),c="string"==typeof e,d=!1;for(t.clearInternals===!0&&(d=!0),n=c?wysihtml5.dom.getAsDom(e,a):e,w.selectors&&o(n,w.selectors);n.firstChild;)s=n.firstChild,r=i(s,t.cleanUp,d,t.uneditableClass),r&&l.appendChild(r),s!==r&&n.removeChild(s);if(t.unjoinNbsps)for(var u=wysihtml5.dom.getTextNodes(l),h=u.length;h--;)u[h].nodeValue=u[h].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return n.innerHTML="",n.appendChild(l),c?wysihtml5.quirks.getCorrectInnerHTML(n):n}function i(e,t,n,o){var r,s,a,l=e.nodeType,c=e.childNodes,d=c.length,u=g[l],h=0;if(o&&1===l&&wysihtml5.dom.hasClass(e,o))return e;if(s=u&&u(e,n),!s){if(s===!1){for(r=e.ownerDocument.createDocumentFragment(),h=d;h--;)c[h]&&(a=i(c[h],t,n,o),a&&(c[h]===a&&h--,r.insertBefore(a,r.firstChild)));return"block"===wysihtml5.dom.getStyle("display").from(e)&&r.appendChild(e.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||r.appendChild(e.ownerDocument.createTextNode(" "))),r.normalize&&r.normalize(),r}return null}for(h=0;d>h;h++)c[h]&&(a=i(c[h],t,n,o),a&&(c[h]===a&&h--,s.appendChild(a)));if(t&&s.nodeName.toLowerCase()===p&&(!s.childNodes.length||/^\s*$/gi.test(s.innerHTML)&&(n||"_wysihtml5-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!s.attributes.length)){for(r=s.ownerDocument.createDocumentFragment();s.firstChild;)r.appendChild(s.firstChild);return r.normalize&&r.normalize(),r}return s.normalize&&s.normalize(),s}function o(e,t){var n,i,o;for(n in t)if(t.hasOwnProperty(n)){wysihtml5.lang.object(t[n]).isFunction()?i=t[n]:"string"==typeof t[n]&&S[t[n]]&&(i=S[t[n]]),o=e.querySelectorAll(n);for(var r=o.length;r--;)i(o[r])}}function r(e,t){var n,i,o,r=w.tags,a=e.nodeName.toLowerCase(),c=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(c&&"HTML"!=c&&(a=c+":"+a),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(a="div")),a in r){if(n=r[a],!n||n.remove)return null;if(n.unwrap)return!1;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:p}}if(n.one_of_type&&!s(e,w,n.one_of_type,t)){if(!n.remove_action)return null;if("unwrap"===n.remove_action)return!1;if("rename"!==n.remove_action)return null;o=n.remove_action_rename_to||p}return i=e.ownerDocument.createElement(o||n.rename_tag||a),h(e,i,n,t),l(e,i,n),e=null,i.normalize&&i.normalize(),i}function s(e,t,n,i){var o,r;if("SPAN"===e.nodeName&&!i&&("_wysihtml5-temp-placeholder"===e.className||"rangySelectionBoundary"===e.className))return!0;for(r in n)if(n.hasOwnProperty(r)&&t.type_definitions&&t.type_definitions[r]&&(o=t.type_definitions[r],a(e,o)))return!0;return!1}function a(e,t){var n,i,o,r,s,a=e.getAttribute("class"),l=e.getAttribute("style");if(t.methods)for(var c in t.methods)if(t.methods.hasOwnProperty(c)&&x[c]&&x[c](e))return!0;if(a&&t.classes){a=a.replace(/^\s+/g,"").replace(/\s+$/g,"").split(y),n=a.length;for(var d=0;n>d;d++)if(t.classes[a[d]])return!0}if(l&&t.styles){l=l.split(";");for(i in t.styles)if(t.styles.hasOwnProperty(i))for(var u=l.length;u--;)if(s=l[u].split(":"),s[0].replace(/\s/g,"").toLowerCase()===i&&(t.styles[i]===!0||1===t.styles[i]||wysihtml5.lang.array(t.styles[i]).contains(s[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(o in t.attrs)if(t.attrs.hasOwnProperty(o)&&(r=wysihtml5.dom.getAttribute(e,o),"string"==typeof r&&r.search(t.attrs[o])>-1))return!0;return!1}function l(e,t,n){var i,o;if(n&&n.keep_styles)for(i in n.keep_styles)if(n.keep_styles.hasOwnProperty(i)){if(o="float"===i?e.style.styleFloat||e.style.cssFloat:e.style[i],n.keep_styles[i]instanceof RegExp&&!n.keep_styles[i].test(o))continue;"float"===i?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=o:e.style[i]&&(t.style[i]=o)}}function c(e,t){var n=[];for(var i in t)t.hasOwnProperty(i)&&0===i.indexOf(e)&&n.push(i);return n}function d(e,t,n,i){var o,r=C[n];return r&&(t||"alt"===e&&"IMG"==i)&&(o=r(t),"string"==typeof o)?o:!1}function u(e,t){var n,i,o,r=wysihtml5.lang.object(w.attributes||{}).clone(),s=wysihtml5.lang.object(r).merge(wysihtml5.lang.object(t||{}).clone()).get(),a={},l=wysihtml5.dom.getAttributes(e);for(n in s)if(/\*$/.test(n)){o=c(n.slice(0,-1),l);for(var u=0,h=o.length;h>u;u++)i=d(o[u],l[o[u]],s[n],e.nodeName),i!==!1&&(a[o[u]]=i)}else i=d(n,l[n],s[n],e.nodeName),i!==!1&&(a[n]=i);return a}function h(e,t,n,i){var o,r,s,a,l,c={},d=n.set_class,h=n.add_class,f=n.add_style,m=n.set_attributes,g=w.classes,p=0,v=[],b=[],C=[],x=[];if(m&&(c=wysihtml5.lang.object(m).clone()),c=wysihtml5.lang.object(c).merge(u(e,n.check_attributes)).get(),d&&v.push(d),h)for(a in h)l=E[h[a]],l&&(s=l(wysihtml5.dom.getAttribute(e,a)),"string"==typeof s&&v.push(s));if(f)for(a in f)l=N[f[a]],l&&(newStyle=l(wysihtml5.dom.getAttribute(e,a)),"string"==typeof newStyle&&b.push(newStyle));if("string"==typeof g&&"any"===g&&e.getAttribute("class"))if(w.classes_blacklist){for(x=e.getAttribute("class"),x&&(v=v.concat(x.split(y))),o=v.length;o>p;p++)r=v[p],w.classes_blacklist[r]||C.push(r);C.length&&(c["class"]=wysihtml5.lang.array(C).unique().join(" "))}else c["class"]=e.getAttribute("class");else{for(i||(g["_wysihtml5-temp-placeholder"]=1,g._rangySelectionBoundary=1,g["wysiwyg-tmp-selected-cell"]=1),x=e.getAttribute("class"),x&&(v=v.concat(x.split(y))),o=v.length;o>p;p++)r=v[p],g[r]&&C.push(r);C.length&&(c["class"]=wysihtml5.lang.array(C).unique().join(" "))}c["class"]&&i&&(c["class"]=c["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(c["class"])&&delete c["class"]),b.length&&(c.style=wysihtml5.lang.array(b).unique().join(" "));for(a in c)try{t.setAttribute(a,c[a])}catch(S){}c.src&&("undefined"!=typeof c.width&&t.setAttribute("width",c.width),"undefined"!=typeof c.height&&t.setAttribute("height",c.height))}function f(e){var t=e.nextSibling;if(!t||t.nodeType!==wysihtml5.TEXT_NODE){var n=e.data.replace(b,"");return e.ownerDocument.createTextNode(n)}t.data=e.data.replace(b,"")+t.data.replace(b,"")}function m(e){return w.comments?e.ownerDocument.createComment(e.nodeValue):void 0}var g={1:r,3:f,8:m},p="span",y=/\s+/,v={tags:{},classes:{}},w={},b=/\uFEFF/g,C={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),href:function(){var e=/^(#|\/|https?:\/\/|mailto:)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}(),any:function(){return function(e){return e}}()},N={align_text:function(){var e={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return e[String(t).toLowerCase()]}}()},E={align_img:function(){var e=wysihtml5.classes.image["float"];return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e=wysihtml5.classes.align_text;return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e=wysihtml5.classes.size_font;return function(t){return e[String(t).charAt(0)]}}()},x={has_visible_contet:function(){var e,t=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(n){if(e=(n.innerText||n.textContent).replace(/\s/g,""),e&&e.length>0)return!0;for(var i=t.length;i--;)if(n.querySelector(t[i]))return!0;return!!(n.offsetWidth&&n.offsetWidth>0&&n.offsetHeight&&n.offsetHeight>0)}}()},S={unwrap:function(e){wysihtml5.dom.unwrap(e)},remove:function(e){e.parentNode.removeChild(e)}};return n(e,t)},wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,n=wysihtml5.lang.array(e.childNodes).get(),i=n.length,o=0;i>o;o++)t=n[o],t.nodeType===wysihtml5.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var n,i=e.ownerDocument.createElement(t);n=e.firstChild;)i.appendChild(n);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(i),e.parentNode.replaceChild(i,e),i},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return void e.parentNode.removeChild(e);for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function n(e){return"BR"===e.nodeName}function i(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function o(e,o){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var r,s,a,l,c,d,u=e.ownerDocument,h=u.createDocumentFragment(),f=wysihtml5.dom.domNode(e).prev({ignoreBlankTexts:!0});if(o)for(!f||t(f)||n(f)||i(h);d=e.firstElementChild||e.firstChild;){for(s=d.lastChild;r=d.firstChild;)a=r===s,l=a&&!t(r)&&!n(r),h.appendChild(r),l&&i(h);d.parentNode.removeChild(d)}else for(;d=e.firstElementChild||e.firstChild;){if(d.querySelector&&d.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;r=d.firstChild;)h.appendChild(r);else{for(c=u.createElement("p");r=d.firstChild;)c.appendChild(r);h.appendChild(c)}d.parentNode.removeChild(d)}e.parentNode.replaceChild(h,e)}}e.resolveList=o}(wysihtml5.dom),function(e){var t=document,n=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],i=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],o=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,i=t.createElement("iframe");return i.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0}).on(i),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(i.src="javascript:'<html></html>'"),i.onload=function(){i.onreadystatechange=i.onload=null,n._onLoadIframe(i)},i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=i.onload=null,n._onLoadIframe(i))},i},_onLoadIframe:function(r){if(e.dom.contains(t.documentElement,r)){var s=this,a=r.contentWindow,l=r.contentWindow.document,c=t.characterSet||t.charset||"utf-8",d=this._getHtml({charset:c,stylesheets:this.config.stylesheets});if(l.open("text/html","replace"),l.write(d),l.close(),this.getWindow=function(){return r.contentWindow},this.getDocument=function(){return r.contentWindow.document},a.onerror=function(e,t,n){throw new Error("wysihtml5.Sandbox: "+e,t,n)},!e.browser.supportsSandboxedIframes()){var u,h;for(u=0,h=n.length;h>u;u++)this._unset(a,n[u]);for(u=0,h=i.length;h>u;u++)this._unset(a,i[u],e.EMPTY_FUNCTION);for(u=0,h=o.length;h>u;u++)this._unset(l,o[u]);this._unset(l,"cookie","",!0)}this.loaded=!0,setTimeout(function(){s.callback(s)},0)}},_getHtml:function(t){var n,i=t.stylesheets,o="",r=0;if(i="string"==typeof i?[i]:i)for(n=i.length;n>r;r++)o+='<link rel="stylesheet" href="'+i[r]+'">';return t.stylesheets=o,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,i,o){try{t[n]=i}catch(r){}try{t.__defineGetter__(n,function(){return i})}catch(r){}if(o)try{t.__defineSetter__(n,function(){})}catch(r){}if(!e.browser.crashesWhenDefineProperty(n))try{var s={get:function(){return i}};o&&(s.set=function(){}),Object.defineProperty(t,n,s)}catch(r){}}})}(wysihtml5),function(e){var t=document;e.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(t,n,i){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),i?this.element=this._bindElement(i):this.element=this._createElement()},_createElement:function(){var e=t.createElement("div");return e.className="wysihtml5-sandbox",this._loadElement(e),e},_bindElement:function(e){return e.className=e.className&&""!=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n=this;if(!t){var i=this._getHtml();e.innerHTML=i}this.getWindow=function(){return e.ownerDocument.defaultView},this.getDocument=function(){return e.ownerDocument},this.loaded=!0,setTimeout(function(){rangy&&rangy.getSelection&&rangy.getSelection().removeAllRanges(),n.callback(n)},0)},_getHtml:function(){return""}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var i in t)n.setAttribute(e[i]||i,t[i])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var n=t.style;if("string"==typeof e)return void(n.cssText+=";"+e);for(var i in e)"float"===i?(n.cssFloat=e[i],n.styleFloat=e[i]):n[i]=e[i]}}},function(e){e.simulatePlaceholder=function(t,n,i){var o="placeholder",r=function(){var t=n.element.offsetWidth>0&&n.element.offsetHeight>0;n.hasPlaceholderSet()&&(n.clear(),n.element.focus(),t&&setTimeout(function(){var e=n.selection.getSelection();e.focusNode&&e.anchorNode||n.selection.selectNode(n.element.firstChild||n.element)},0)),n.placeholderSet=!1,e.removeClass(n.element,o)},s=function(){n.isEmpty()&&(n.placeholderSet=!0,n.setValue(i),e.addClass(n.element,o))};t.on("set_placeholder",s).on("unset_placeholder",r).on("focus:composer",r).on("paste:composer",r).on("blur:composer",s),s()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(e,t){var n=!wysihtml5.browser.supportsGetAttributeCorrectly();t=t.toLowerCase();var i=e.nodeName;if("IMG"==i&&"src"==t&&wysihtml5.dom.isLoadedImage(e)===!0)return e.src;if(n&&"outerHTML"in e){var o=e.outerHTML.toLowerCase(),r=-1!=o.indexOf(" "+t+"=");return r?e.getAttribute(t):null}return e.getAttribute(t)},wysihtml5.dom.getAttributes=function(e){var t,n=!wysihtml5.browser.supportsGetAttributeCorrectly(),i=e.nodeName,o=[];for(t in e.attributes)(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(t)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,t))&&e.attributes[t].specified&&("IMG"==i&&"src"==e.attributes[t].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(e)===!0?o.src=e.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(e.attributes[t].name.toLowerCase())&&n?1!==e.attributes[t].value&&(o[e.attributes[t].name]=e.attributes[t].value):o[e.attributes[t].name]=e.attributes[t].value);return o},wysihtml5.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}},function(e){function t(e,t){for(var n,i=[],o=0,r=e.length;r>o;o++)if(n=e[o].querySelectorAll(t))for(var s=n.length;s--;i.unshift(n[s]));return i}function n(e){e.parentNode.removeChild(e)}function i(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function o(e,t){for(var n=e.nextSibling;1!=n.nodeType;)if(n=n.nextSibling,!t||t==n.tagName.toLowerCase())return n;return null}var r=e.dom,s=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},a=function(e,t){e?(this.cell=e,this.table=r.getParentElement(e,{nodeName:["TABLE"]})):t&&(this.table=t,this.cell=this.table.querySelectorAll("th, td")[0])};a.prototype={addSpannedCellToMap:function(e,t,n,i,o,r){for(var a=[],l=n+(r?parseInt(r,10)-1:0),c=i+(o?parseInt(o,10)-1:0),d=n;l>=d;d++){"undefined"==typeof t[d]&&(t[d]=[]);for(var u=i;c>=u;u++)t[d][u]=new s(e),t[d][u].isColspan=o&&parseInt(o,10)>1,t[d][u].isRowspan=r&&parseInt(r,10)>1,t[d][u].firstCol=u==i,t[d][u].lastCol=u==c,t[d][u].firstRow=d==n,t[d][u].lastRow=d==l,t[d][u].isReal=u==i&&d==n,t[d][u].spanCollection=a,a.push(t[d][u])}},setCellAsModified:function(e){if(e.modified=!0,e.spanCollection.length>0)for(var t=0,n=e.spanCollection.length;n>t;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e,t,n,i,o,a,l,c,d=[],u=this.getTableRows();for(e=0;e<u.length;e++)for(t=u[e],n=this.getRowCells(t),a=0,"undefined"==typeof d[e]&&(d[e]=[]),i=0;i<n.length;i++){for(o=n[i];"undefined"!=typeof d[e][a];)a++;l=r.getAttribute(o,"colspan"),c=r.getAttribute(o,"rowspan"),l||c?(this.addSpannedCellToMap(o,d,e,a,l,c),a+=l?parseInt(l,10):1):(d[e][a]=new s(o),a++)}return this.map=d,d},getRowCells:function(n){var i=this.table.querySelectorAll("table"),o=i?t(i,"th, td"):[],r=n.querySelectorAll("th, td"),s=o.length>0?e.lang.array(r).without(o):r;return s},getTableRows:function(){var n=this.table.querySelectorAll("table"),i=n?t(n,"tr"):[],o=this.table.querySelectorAll("tr"),r=i.length>0?e.lang.array(o).without(i):o;return r},getMapIndex:function(e){for(var t=this.map.length,n=this.map&&this.map[0]?this.map[0].length:0,i=0;t>i;i++)for(var o=0;n>o;o++)if(this.map[i][o].el===e)return{row:i,col:o};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var n=this.idx_start;this.idx_start=this.idx_end,this.idx_end=n}if(this.idx_start.col>this.idx_end.col){var i=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=i}if(null!=this.idx_start&&null!=this.idx_end)for(var o=this.idx_start.row,r=this.idx_end.row;r>=o;o++)for(var s=this.idx_start.col,a=this.idx_end.col;a>=s;s++)t.push(this.map[o][s].el);return t},orderSelectionEnds:function(e){if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}return{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,n){for(var i,o=this.table.ownerDocument,r=o.createDocumentFragment(),s=0;t>s;s++){if(i=o.createElement(e),n)for(var a in n)n.hasOwnProperty(a)&&i.setAttribute(a,n[a]);i.appendChild(document.createTextNode(" ")),r.appendChild(i)}return r},correctColIndexForUnreals:function(e,t){for(var n=this.map[t],i=-1,o=0;e>o;o++)n[o].isReal&&i++;return i},getLastNewCellOnRow:function(e,t){for(var n,i,o=this.getRowCells(e),r=0,s=o.length;s>r;r++)if(n=o[r],i=this.getMapIndex(n),i===!1||"undefined"!=typeof t&&i.row!=t)return n;return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return e&&0!=e.length?!1:(n(this.table),!0)},splitRowToCells:function(e){if(e.isColspan){var t=parseInt(r.getAttribute(e.el,"colspan")||1,10),n=e.el.tagName.toLowerCase();if(t>1){var o=this.createCells(n,t-1);i(e.el,o)}e.el.removeAttribute("colspan")}},getRealRowEl:function(e,t){var n=null,i=null;t=t||this.idx;for(var o=0,s=this.map[t.row].length;s>o;o++)if(i=this.map[t.row][o],i.isReal&&(n=r.getParentElement(i.el,{nodeName:["TR"]})))return n;return null===n&&e&&(n=r.getParentElement(this.map[t.row][t.col].el,{nodeName:["TR"]})||null),n},injectRowAt:function(e,t,n,o,s){var a=this.getRealRowEl(!1,{row:e,col:t}),l=this.createCells(o,n);if(a){var c=this.correctColIndexForUnreals(t,e);c>=0?i(this.getRowCells(a)[c],l):a.insertBefore(l,a.firstChild)}else{var d=this.table.ownerDocument.createElement("tr");d.appendChild(l),i(r.getParentElement(s.el,{nodeName:["TR"]}),d)}},canMerge:function(e){if(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col){var t=this.idx_start;this.idx_start=this.idx_end,this.idx_end=t}if(this.idx_start.col>this.idx_end.col){var n=this.idx_start.col;this.idx_start.col=this.idx_end.col,this.idx_end.col=n}for(var i=this.idx_start.row,o=this.idx_end.row;o>=i;i++)for(var r=this.idx_start.col,s=this.idx_end.col;s>=r;r++)if(this.map[i][r].isColspan||this.map[i][r].isRowspan)return!1;return!0},decreaseCellSpan:function(e,t){var n=parseInt(r.getAttribute(e.el,t),10)-1;n>=1?e.el.setAttribute(t,n):(e.el.removeAttribute(t),"colspan"==t&&(e.isColspan=!1),"rowspan"==t&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,t,i,o,s,a,l;if(this.setTableMap(),this.map){for(i=0,o=this.map.length;o>i;i++){for(e=this.map[i],l=!0,s=0,a=e.length;a>s;s++)if(t=e[s],!(r.getAttribute(t.el,"rowspan")&&parseInt(r.getAttribute(t.el,"rowspan"),10)>1&&t.firstRow!==!0)){l=!1;break}if(l)for(s=0;a>s;s++)this.decreaseCellSpan(e[s],"rowspan")}var c=this.getTableRows();for(i=0,o=c.length;o>i;i++)e=c[i],0==e.childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&n(e)}},fillMissingCells:function(){var e=0,t=0,n=null;if(this.setTableMap(),this.map){e=this.map.length;for(var o=0;e>o;o++)this.map[o].length>t&&(t=this.map[o].length);for(var r=0;e>r;r++)for(var a=0;t>a;a++)this.map[r]&&!this.map[r][a]&&a>0&&(this.map[r][a]=new s(this.createCells("td",1)),n=this.map[r][a-1],n&&n.el&&n.el.parent&&i(this.map[r][a-1].el,this.map[r][a].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var e=this.map[this.idx.row][this.idx.col],t=r.getAttribute(e.el,"colspan")?parseInt(r.getAttribute(e.el,"colspan"),10):1,n=e.el.tagName.toLowerCase();if(e.isRowspan){var i=parseInt(r.getAttribute(e.el,"rowspan"),10);if(i>1)for(var o=1,s=i-1;s>=o;o++)this.injectRowAt(this.idx.row+o,this.idx.col,t,n,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function(e){if(this.rectify())if(this.canMerge(e)){for(var t=this.idx_end.row-this.idx_start.row+1,i=this.idx_end.col-this.idx_start.col+1,o=this.idx_start.row,r=this.idx_end.row;r>=o;o++)for(var s=this.idx_start.col,a=this.idx_end.col;a>=s;s++)o==this.idx_start.row&&s==this.idx_start.col?(t>1&&this.map[o][s].el.setAttribute("rowspan",t),i>1&&this.map[o][s].el.setAttribute("colspan",i)):(/^\s*<br\/?>\s*$/.test(this.map[o][s].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[o][s].el.innerHTML),n(this.map[o][s].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(e){var t=this.getMapIndex(e.el),n=t.row+1,o={row:n,col:t.col};if(n<this.map.length){var s=this.getRealRowEl(!1,o);if(null!==s){var a=this.correctColIndexForUnreals(o.col,o.row);if(a>=0)i(this.getRowCells(s)[a],e.el);else{var l=this.getLastNewCellOnRow(s,n);null!==l?i(l,e.el):s.insertBefore(e.el,s.firstChild)}parseInt(r.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")}}},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):n(e.el):parseInt(r.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=this.map[this.idx.row],n=0,i=t.length;i>n;n++)t[n].isReal&&e.push(t[n].el);return e},getColumnElementsByCell:function(){var e=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=0,n=this.map.length;n>t;t++)this.map[t][this.idx.col]&&this.map[t][this.idx.col].isReal&&e.push(this.map[t][this.idx.col].el);return e},removeRow:function(){var e=r.getParentElement(this.cell,{nodeName:["TR"]});if(e){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var t=this.map[this.idx.row],i=0,o=t.length;o>i;i++)t[i].modified||(this.setCellAsModified(t[i]),this.removeRowCell(t[i]));n(e)}},removeColCell:function(e){e.isColspan?parseInt(r.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(r.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&n(e.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var e=0,t=this.map.length;t>e;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var t=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&r.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(r.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(var n=this.map[this.idx.row],o=t.createElement("tr"),s=0,a=n.length;a>s;s++)n[s].modified||(this.setCellAsModified(n[s]),this.addRowCell(n[s],o,e));switch(e){case"below":i(this.getRealRowEl(!0),o);break;case"above":var l=r.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]});l&&l.parentNode.insertBefore(o,l)}}},addRowCell:function(e,t,n){var i=e.isColspan?{colspan:r.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=n&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)+1):t.appendChild(this.createCells("td",1,i)):"above"!=n&&e.isRowspan&&e.lastRow?t.appendChild(this.createCells("td",1,i)):c.isRowspan&&e.el.attr("rowspan",parseInt(r.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&("below"!=e&&"above"!=e||this.addRow(e),"before"!=e&&"after"!=e||this.addColumn(e))},addColCell:function(e,t,n){var o,s=e.el.tagName.toLowerCase();switch(n){case"before":o=!e.isColspan||e.firstCol;break;case"after":o=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(o){switch(n){case"before":e.el.parentNode.insertBefore(this.createCells(s,1),e.el);break;case"after":i(e.el,this.createCells(s,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,t+1,n)}else e.el.setAttribute("colspan",parseInt(r.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var t,n;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&r.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(r.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(var i=0,o=this.map.length;o>i;i++)t=this.map[i],t[this.idx.col]&&(n=t[this.idx.col],n.modified||(this.setCellAsModified(n),this.addColCell(n,i,e)))},handleCellAddWithRowspan:function(e,t,n){for(var s,a,l,c=parseInt(r.getAttribute(this.cell,"rowspan"),10)-1,d=r.getParentElement(e.el,{nodeName:["TR"]}),u=e.el.tagName.toLowerCase(),h=this.table.ownerDocument,f=0;c>f;f++)if(s=this.correctColIndexForUnreals(this.idx.col,t+f),d=o(d,"tr"))if(s>0)switch(n){case"before":a=this.getRowCells(d),s>0&&this.map[t+f][this.idx.col].el!=a[s]&&s==a.length-1?i(a[s],this.createCells(u,1)):a[s].parentNode.insertBefore(this.createCells(u,1),a[s]);
break;case"after":i(this.getRowCells(d)[s],this.createCells(u,1))}else d.insertBefore(this.createCells(u,1),d.firstChild);else l=h.createElement("tr"),l.appendChild(this.createCells(u,1)),this.table.appendChild(l)}},r.table={getCellsBetween:function(e,t){var n=new a(e);return n.getMapElsTo(t)},addCells:function(e,t){var n=new a(e);n.add(t)},removeCells:function(e,t){var n=new a(e);n.remove(t)},mergeCellsBetween:function(e,t){var n=new a(e);n.merge(t)},unmergeCell:function(e){var t=new a(e);t.unmerge()},orderSelectionEnds:function(e,t){var n=new a(e);return n.orderSelectionEnds(t)},indexOf:function(e){var t=new a(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){var n=new a(null,e);return n.getElementAtIndex(t)},findRowByCell:function(e){var t=new a(e);return t.getRowElementsByCell()},findColumnByCell:function(e){var t=new a(e);return t.getColumnElementsByCell()},canMerge:function(e,t){var n=new a(e);return n.canMerge(t)}}}(wysihtml5),wysihtml5.dom.query=function(e,t){var n,i=[];e.nodeType&&(e=[e]);for(var o=0,r=e.length;r>o;o++)if(n=e[o].querySelectorAll(t))for(var s=n.length;s--;i.unshift(n[s]));return i},wysihtml5.dom.compareDocumentPosition=function(){var e=document.documentElement;return e.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var n,i;if(n=9===e.nodeType?e:e.ownerDocument,i=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(n!==i)return 1;if(2===e.nodeType&&e.childNodes&&-1!==wysihtml5.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==wysihtml5.lang.array(t.childNodes).indexOf(e))return 10;for(var o=e,r=[],s=null;o;){if(o==t)return 10;r.push(o),o=o.parentNode}for(o=t,s=null;o;){if(o==e)return 20;var a=wysihtml5.lang.array(r).indexOf(o);if(-1!==a){var l=r[a],c=wysihtml5.lang.array(l.childNodes).indexOf(r[a-1]),d=wysihtml5.lang.array(l.childNodes).indexOf(s);return c>d?2:4}s=o,o=o.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(e){if(e.parentNode){for(;e.lastChild;)wysihtml5.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}},wysihtml5.dom.getPastedHtml=function(e){var t;return e.clipboardData&&(wysihtml5.lang.array(e.clipboardData.types).contains("text/html")?t=e.clipboardData.getData("text/html"):wysihtml5.lang.array(e.clipboardData.types).contains("text/plain")&&(t=wysihtml5.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t},wysihtml5.dom.getPastedHtmlWithDiv=function(e,t){var n=e.selection.getBookmark(),i=e.element.ownerDocument,o=i.createElement("DIV");i.body.appendChild(o),o.style.width="1px",o.style.height="1px",o.style.overflow="hidden",o.setAttribute("contenteditable","true"),o.focus(),setTimeout(function(){e.selection.setBookmark(n),t(o.innerHTML),o.parentNode.removeChild(o)},0)},wysihtml5.quirks.cleanPastedHTML=function(){var e=function(e){var t=wysihtml5.lang.string(e).trim(),n=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+n+"$).)*$","i")},t=function(t,n){var i,o,r=wysihtml5.lang.object(t).clone(!0);for(i in r.tags)if(r.tags.hasOwnProperty(i)&&r.tags[i].keep_styles)for(o in r.tags[i].keep_styles)r.tags[i].keep_styles.hasOwnProperty(o)&&n[o]&&(r.tags[i].keep_styles[o]=e(n[o]));return r},n=function(e,t){var n;if(!e)return null;for(var i=0,o=e.length;o>i;i++)if(e[i].condition||(n=e[i].set),e[i].condition&&e[i].condition.test(t))return e[i].set;return n};return function(e,i){var o,r={color:wysihtml5.dom.getStyle("color").from(i.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(i.referenceNode)},s=t(n(i.rules,e)||{},r);return o=wysihtml5.dom.parse(e,{rules:s,cleanUp:!0,context:i.referenceNode.ownerDocument,uneditableClass:i.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}(),wysihtml5.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();"<p>&nbsp;</p>"!=t&&"<p>&nbsp;</p><p>&nbsp;</p>"!=t||(e.innerHTML="")},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],e)}}(),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(n){var i=n.innerHTML;if(-1===i.indexOf(t))return i;var o,r,s,a,l=n.querySelectorAll("[href*='~'], [src*='~']");for(a=0,s=l.length;s>a;a++)o=l[a].href||l[a].src,r=e.lang.string(o).replace("~").by(t),i=e.lang.string(i).replace(r).by(o);return i}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(n){e.dom.addClass(n,t),e.dom.removeClass(n,t);try{var i=n.ownerDocument;i.execCommand("italic",!1,null),i.execCommand("italic",!1,null)}catch(o){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(e,t){function n(){return d.observe(e,"mousedown",function(e){var t=wysihtml5.dom.getParentElement(e.target,{nodeName:["TD","TH"]});t&&i(t)}),u}function i(n){u.start=n,u.end=n,u.cells=[n],u.table=d.getParentElement(u.start,{nodeName:["TABLE"]}),u.table&&(o(),d.addClass(n,h),f=d.observe(e,"mousemove",s),m=d.observe(e,"mouseup",a),t.fire("tableselectstart").fire("tableselectstart:composer"))}function o(){if(e){var t=e.querySelectorAll("."+h);if(t.length>0)for(var n=0;n<t.length;n++)d.removeClass(t[n],h)}}function r(e){for(var t=0;t<e.length;t++)d.addClass(e[t],h)}function s(e){var n,i=null,s=d.getParentElement(e.target,{nodeName:["TD","TH"]});s&&u.table&&u.start&&(i=d.getParentElement(s,{nodeName:["TABLE"]}),i&&i===u.table&&(o(),n=u.end,u.end=s,u.cells=d.table.getCellsBetween(u.start,s),u.cells.length>1&&t.composer.selection.deselect(),r(u.cells),u.end!==n&&t.fire("tableselectchange").fire("tableselectchange:composer")))}function a(){f.stop(),m.stop(),t.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){l()},0)}function l(){var n=d.observe(e.ownerDocument,"click",function(e){n.stop();var i=d.closest(e.target,"div");return i&&i===t.toolbar.container?!1:void(d.getParentElement(e.target,{nodeName:["TABLE"]})!=u.table&&(o(),u.table=null,u.start=null,u.end=null,t.fire("tableunselect").fire("tableunselect:composer")))})}function c(e,n){u.start=e,u.end=n,u.table=d.getParentElement(u.start,{nodeName:["TABLE"]}),selectedCells=d.table.getCellsBetween(u.start,u.end),r(selectedCells),l(),t.fire("tableselect").fire("tableselect:composer")}var d=wysihtml5.dom,u={table:null,start:null,end:null,cells:null,select:c},h="wysiwyg-tmp-selected-cell",f=null,m=null;return n()},function(e){var t=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,n=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,i=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,o=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,r=function(e){return new RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};e.quirks.styleParser={parseColor:function(s,a){var l,c,d=r(a),u=s.match(d),h=10;if(u){for(var f=u.length;f--;)u[f]=e.lang.string(u[f].split(":")[1]).trim();if(l=u[u.length-1],t.test(l))c=l.match(t);else if(n.test(l))c=l.match(n);else if(i.test(l))c=l.match(i),h=16;else if(o.test(l))return c=l.match(o),c.shift(),c.push(1),e.lang.array(c).map(function(e,t){return 3>t?16*parseInt(e,16)+parseInt(e,16):parseFloat(e)});if(c)return c.shift(),c[3]||c.push(1),e.lang.array(c).map(function(e,t){return 3>t?parseInt(e,h):parseFloat(e)})}return!1},unparseColor:function(e,t){if(t){if("hex"==t)return e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("hash"==t)return"#"+e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("rgb"==t)return"rgb("+e[0]+","+e[1]+","+e[2]+")";if("rgba"==t)return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")";if("csv"==t)return e[0]+","+e[1]+","+e[2]+","+e[3]}return e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(t){var n=t.match(r("font-size"));return n?e.lang.string(n[n.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}function n(e,t){for(var n=0;t!==e;)if(n++,t=t.parentNode,!t)throw new Error("not a descendant of ancestor!");return n}function i(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,i=n(t,e.startContainer),o=n(t,e.endContainer);!e.canSurroundContents();)i>o?(e.setStartBefore(e.startContainer),i=n(t,e.startContainer)):(e.setEndAfter(e.endContainer),o=n(t,e.endContainer))}var o=e.dom;e.Selection=Base.extend({constructor:function(e,t,n){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&i(e),e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(t,n){var i=rangy.createRange(this.doc),r=t.nodeType===e.ELEMENT_NODE,s="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,a=r?t.innerHTML:t.data,l=""===a||a===e.INVISIBLE_SPACE,c=o.getStyle("display").from(t),d="block"===c||"list-item"===c;if(l&&r&&s&&!n)try{t.innerHTML=e.INVISIBLE_SPACE}catch(u){}s?i.selectNodeContents(t):i.selectNode(t),s&&l&&r?i.collapse(d):s&&l&&(i.setStartAfter(t),i.setEndAfter(t)),this.setSelection(i)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange(),n&&n.length)?n.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc),n?n.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var e=this.getRange();i(e),this.setSelection(e)},getSelectedOwnNodes:function(){for(var e=this.getOwnRanges(),t=[],n=0,i=e.length;i>n;n++)t.push(e[n].commonAncestorContainer||this.doc.body);return t},findNodesInSelection:function(t){for(var n,i=this.getOwnRanges(),o=[],r=0,s=i.length;s>r;r++)n=i[r].getNodes([1],function(n){return e.lang.array(t).contains(n.nodeName)}),o=o.concat(n);return o},containsUneditable:function(){for(var e=this.getOwnUneditables(),t=this.getSelection(),n=0,i=e.length;i>n;n++)if(t.containsNode(e[n]))return!0;return!1},deleteContents:function(){for(var e=this.getOwnRanges(),t=e.length;t--;)e[t].deleteContents();this.setSelection(e[0])},getPreviousNode:function(t,n){if(!t){var i=this.getSelection();t=i.anchorNode}if(t===this.contain)return!1;var o,r=t.previousSibling;return r===this.contain?!1:(r&&3!==r.nodeType&&1!==r.nodeType?r=this.getPreviousNode(r,n):r&&3===r.nodeType&&/^\s*$/.test(r.textContent)?r=this.getPreviousNode(r,n):n&&r&&1===r.nodeType&&!e.lang.array(["BR","HR","IMG"]).contains(r.nodeName)&&/^[\s]*$/.test(r.innerHTML)?r=this.getPreviousNode(r,n):r||t===this.contain||(o=t.parentNode,o!==this.contain&&(r=this.getPreviousNode(o,n))),r!==this.contain?r:!1)},getSelectionParentsByTag:function(){for(var t,n=this.getSelectedOwnNodes(),i=[],o=0,r=n.length;r>o;o++)t=n[o].nodeName&&"LI"===n[o].nodeName?n[o]:e.dom.getParentElement(n[o],{nodeName:["LI"]},!1,this.contain),t&&i.push(t);return i.length?i:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,i=rangy.createRange(this.doc);return i.selectNodeContents(t),i.setStart(t,n),i}},caretIsLastInSelection:function(){var e=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),t=e.textContent;return/^\s*$/.test(t)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),n=this.getSelection(),i=this.getRange(),o=i.startContainer;return o.nodeType===e.TEXT_NODE?this.isCollapsed()&&o.nodeType===e.TEXT_NODE&&/^\s*$/.test(o.data.substr(0,i.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===n.anchorNode||t.endContainer===n.anchorNode)&&t.startOffset===n.anchorOffset)},caretIsInTheBeginnig:function(t){var n=this.getSelection(),i=n.anchorNode,o=n.anchorOffset;return t?0===o&&(i.nodeName&&i.nodeName===t.toUpperCase()||e.dom.getParentElement(i.parentNode,{nodeName:t},1)):0===o&&!this.getPreviousNode(i,!0)},caretIsBeforeUneditable:function(){var e=this.getSelection(),t=e.anchorNode,n=e.anchorOffset;if(0===n){var i=this.getPreviousNode(t,!0);if(i)for(var o=this.getOwnUneditables(),r=0,s=o.length;s>r;r++)if(i===o[r])return o[r]}return!1},executeAndRestoreRangy:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.saveSelection(t);if(n)try{e()}catch(i){setTimeout(function(){throw i},0)}else e();rangy.restoreSelection(n)},executeAndRestore:function(t,n){var i,r,s,a,l,c,d,u,h=this.doc.body,f=n&&h.scrollTop,m=n&&h.scrollLeft,g="_wysihtml5-temp-placeholder",p='<span class="'+g+'">'+e.INVISIBLE_SPACE+"</span>",y=this.getRange(!0);if(!y)return void t(h,h);y.collapsed||(d=y.cloneRange(),c=d.createContextualFragment(p),d.collapse(!1),d.insertNode(c),d.detach()),l=y.createContextualFragment(p),y.insertNode(l),c&&(i=this.contain.querySelectorAll("."+g),y.setStartBefore(i[0]),y.setEndAfter(i[i.length-1])),this.setSelection(y);try{t(y.startContainer,y.endContainer)}catch(v){setTimeout(function(){throw v},0)}if(i=this.contain.querySelectorAll("."+g),i&&i.length){u=rangy.createRange(this.doc),s=i[0].nextSibling,i.length>1&&(a=i[i.length-1].previousSibling),a&&s?(u.setStartBefore(s),u.setEndAfter(a)):(r=this.doc.createTextNode(e.INVISIBLE_SPACE),o.insert(r).after(i[0]),u.setStartBefore(r),u.setEndAfter(r)),this.setSelection(u);for(var w=i.length;w--;)i[w].parentNode.removeChild(i[w])}else this.contain.focus();n&&(h.scrollTop=f,h.scrollLeft=m);try{i.parentNode.removeChild(i)}catch(b){}},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t,n=(rangy.createRange(this.doc),this.doc.createElement("DIV")),i=this.doc.createDocumentFragment();for(n.innerHTML=e,t=n.lastChild;n.firstChild;)i.appendChild(n.firstChild);this.insertNode(i),t&&this.setAfter(t)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t,n=this.getOwnRanges(),i=[];if(0==n.length)return i;for(var o=n.length;o--;){t=this.doc.createElement(e.nodeName),i.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{n[o].surroundContents(t),this.selectNode(t)}catch(r){t.appendChild(n[o].extractContents()),n[o].insertNode(t)}}return i},deblockAndSurround:function(t){var n,i,o,r=this.doc.createElement("div"),s=rangy.createRange(this.doc);if(r.className=t.className,this.composer.commands.exec("formatBlock",t.nodeName,t.className),n=this.contain.querySelectorAll("."+t.className),n[0])for(n[0].parentNode.insertBefore(r,n[0]),s.setStartBefore(n[0]),s.setEndAfter(n[n.length-1]),i=s.extractContents();i.firstChild;)if(o=i.firstChild,1==o.nodeType&&e.dom.hasClass(o,t.className)){for(;o.firstChild;)r.appendChild(o.firstChild);"BR"!==o.nodeName&&r.appendChild(this.doc.createElement("br")),i.removeChild(o)}else r.appendChild(o);else r=null;return r},scrollIntoView:function(){var n,i=this.doc,o=5,r=i.documentElement.scrollHeight>i.documentElement.offsetHeight,s=i._wysihtml5ScrollIntoViewElement=i._wysihtml5ScrollIntoViewElement||function(){var t=i.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();r&&(this.insertNode(s),n=t(s),s.parentNode.removeChild(s),n>=i.body.scrollTop+i.documentElement.offsetHeight-o&&(i.body.scrollTop=n))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView,t=e.getSelection();t.modify("move","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,n,i,o,r=this.doc.selection.createRange(),s=r.boundingTop,a=this.doc.body.scrollWidth;if(r.moveToPoint){for(0===s&&(n=this.doc.createElement("span"),this.insertNode(n),s=n.offsetTop,n.parentNode.removeChild(n)),s+=1,i=-10;a>i;i+=2)try{r.moveToPoint(i,s);break}catch(l){}for(e=s,t=this.doc.selection.createRange(),o=a;o>=0;o--)try{t.moveToPoint(o,e);break}catch(c){}r.setEndPoint("EndToEnd",t),r.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},fixRangeOverflow:function(e){if(this.contain&&this.contain.firstChild&&e){var t=e.compareNode(this.contain);if(2!==t)1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild));else if(this._detectInlineRangeProblems(e)){var n=e.endContainer.previousElementSibling;n&&e.setEnd(n,this._endOffsetForNode(n))}}},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=o.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return e!==!0&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var t=o.query(this.contain,"."+this.unselectableClass),n=o.query(t,"."+this.unselectableClass);return e.lang.array(t).without(n)},getOwnRanges:function(){var e,t=[],n=this.getRange();if(n&&t.push(n),this.unselectableClass&&this.contain&&n){var i,o=this.getOwnUneditables();if(o.length>0)for(var r=0,s=o.length;s>r;r++){e=[];for(var a=0,l=t.length;l>a;a++){if(t[a])switch(t[a].compareNode(o[r])){case 2:break;case 3:i=t[a].cloneRange(),i.setEndBefore(o[r]),e.push(i),i=t[a].cloneRange(),i.setStartAfter(o[r]),e.push(i);break;default:e.push(t[a])}t=e}}}return t},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.getSelection(t);return n.setSingleRange(e)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(t){var n=this.getRange(),i=n.commonAncestorContainer,o=n.startContainer,r=n.endContainer;if(i.nodeType===e.TEXT_NODE&&(i=i.parentNode),o.nodeType===e.TEXT_NODE&&!/^\s*$/.test(o.data.substr(n.startOffset)))return!1;if(r.nodeType===e.TEXT_NODE&&!/^\s*$/.test(r.data.substr(n.endOffset)))return!1;for(;o&&o!==i;){if(o.nodeType!==e.TEXT_NODE&&!e.dom.contains(i,o))return!1;if(e.dom.domNode(o).prev({ignoreBlankTexts:!0}))return!1;o=o.parentNode}for(;r&&r!==i;){if(r.nodeType!==e.TEXT_NODE&&!e.dom.contains(i,r))return!1;if(e.dom.domNode(r).next({ignoreBlankTexts:!0}))return!1;r=r.parentNode}return e.lang.array(t).contains(i.nodeName)?i:!1},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(wysihtml5),function(e,t){function n(e,t,n){if(!e.className)return!1;var i=e.className.match(n)||[];return i[i.length-1]===t}function i(e,t){if(!e.getAttribute||!e.getAttribute("style"))return!1;e.getAttribute("style").match(t);return!!e.getAttribute("style").match(t)}function o(e,t,n){e.getAttribute("style")?(a(e,n),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function r(e,t,n){e.className?(s(e,n),e.className+=" "+t):e.className=t}function s(e,t){e.className&&(e.className=e.className.replace(t,""))}function a(e,t){var n,i=[];if(e.getAttribute("style")){n=e.getAttribute("style").split(";");for(var o=n.length;o--;)n[o].match(t)||/^\s*$/.test(n[o])||i.push(n[o]);i.length?e.setAttribute("style",i.join(";")):e.removeAttribute("style")}}function l(e,t){var n=[],i=t.split(";"),o=e.getAttribute("style");if(o){o=o.replace(/\s/gi,"").toLowerCase(),n.push(new RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var r=i.length;r-- >0;)/^\s*$/.test(i[r])||n.push(new RegExp("(^|\\s|;)"+i[r].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(var s=0,a=n.length;a>s;s++)if(o.match(n[s]))return n[s]}return!1}function c(n,i,o,r){return o?l(n,o):r?e.dom.hasClass(n,r):t.dom.arrayContains(i,n.tagName.toLowerCase())}function d(e,t,n,i){for(var o=e.length;o--;)if(!c(e[o],t,n,i))return!1;return!!e.length}function u(e,t,n){var i=l(e,t);return i?(a(e,i),"remove"):(o(e,t,n),"change")}function h(e,t){return e.className.replace(b," ")==t.className.replace(b," ")}function f(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function m(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,i,o,r=0,s=e.attributes.length;s>r;++r)if(n=e.attributes[r],o=n.name,"class"!=o){if(i=t.attributes.getNamedItem(o),n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function g(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:n>0&&n<e.childNodes.length}function p(e,n,i,o){var r;if(t.dom.isCharacterDataNode(n)&&(0==i?(i=t.dom.getNodeIndex(n),n=n.parentNode):i==n.length?(i=t.dom.getNodeIndex(n)+1,n=n.parentNode):r=t.dom.splitDataNode(n,i)),!(r||o&&n===o)){r=n.cloneNode(!1),r.id&&r.removeAttribute("id");for(var s;s=n.childNodes[i];)r.appendChild(s);t.dom.insertAfter(r,n)}return n==e?r:p(e,r.parentNode,t.dom.getNodeIndex(r),o)}function y(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function v(e,t,n,i,o,r,s){this.tagNames=e||[w],this.cssClass=t||(t===!1?!1:""),this.similarClassRegExp=n,this.cssStyle=o||"",this.similarStyleRegExp=r,this.normalize=i,this.applyToAnyTagName=!1,this.container=s}var w="span",b=/\s+/g;y.prototype={doMerge:function(){for(var e,t,n,i=[],o=0,r=this.textNodes.length;r>o;++o)e=this.textNodes[o],t=e.parentNode,i[o]=e.data,o&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=i.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},v.prototype={getAncestorWithClass:function(i){for(var o;i;){if(o=this.cssClass?n(i,this.cssClass,this.similarClassRegExp):""===this.cssStyle,i.nodeType==e.ELEMENT_NODE&&"false"!=i.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&o)return i;i=i.parentNode}return!1},getAncestorWithStyle:function(n){for(var o;n;){if(o=this.cssStyle?i(n,this.similarStyleRegExp):!1,n.nodeType==e.ELEMENT_NODE&&"false"!=n.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&o)return n;n=n.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),n=!1;return t?this.cssStyle&&(n="class"):(t=this.getAncestorWithStyle(e),t&&(n="style")),{element:t,type:n}},postApply:function(e,t){for(var n,i,o,r=e[0],s=e[e.length-1],a=[],l=r,c=s,d=0,u=s.length,h=0,f=e.length;f>h;++h)i=e[h],o=null,i&&i.parentNode&&(o=this.getAdjacentMergeableTextNode(i.parentNode,!1)),o?(n||(n=new y(o),a.push(n)),n.textNodes.push(i),i===r&&(l=n.firstTextNode,d=l.length),i===s&&(c=n.firstTextNode,u=n.getLength())):n=null;if(s&&s.parentNode){var m=this.getAdjacentMergeableTextNode(s.parentNode,!0);m&&(n||(n=new y(s),a.push(n)),n.textNodes.push(m))}if(a.length){for(h=0,f=a.length;f>h;++h)a[h].doMerge();t.setStart(l,d),t.setEnd(c,u)}},getAdjacentMergeableTextNode:function(t,n){var i,o=t.nodeType==e.TEXT_NODE,r=o?t.parentNode:t,s=n?"nextSibling":"previousSibling";if(o){if(i=t[s],i&&i.nodeType==e.TEXT_NODE)return i}else if(i=r[s],i&&this.areElementsMergeable(t,i))return i[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&h(e,n)&&m(e,n)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var n=e.parentNode;if(1==n.childNodes.length&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase()))this.cssClass&&r(n,this.cssClass,this.similarClassRegExp),this.cssStyle&&o(n,this.cssStyle,this.similarStyleRegExp);else{var i=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(i,e),i.appendChild(e)}},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&""===e.lang.string(n.className).trim()&&(!n.getAttribute("style")||""===e.lang.string(n.getAttribute("style")).trim())},undoToTextNode:function(e,t,n,i){var o=!n,r=n||i,a=!1;if(!t.containsNode(r)){var l=t.cloneRange();l.selectNode(r),l.isPointInRange(t.endContainer,t.endOffset)&&g(t.endContainer,t.endOffset)&&(p(r,t.endContainer,t.endOffset,this.container),t.setEndAfter(r)),l.isPointInRange(t.startContainer,t.startOffset)&&g(t.startContainer,t.startOffset)&&(r=p(r,t.startContainer,t.startOffset,this.container))}!o&&this.similarClassRegExp&&s(r,this.similarClassRegExp),o&&this.similarStyleRegExp&&(a="change"===u(r,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(r)&&!a&&f(r)},applyToRange:function(t){for(var n,i=t.length;i--;){if(n=t[i].getNodes([e.TEXT_NODE]),!n.length)try{var o=this.createContainer(t[i].endContainer.ownerDocument);return t[i].surroundContents(o),void this.selectNode(t[i],o)}catch(r){}if(t[i].splitBoundaries(),n=t[i].getNodes([e.TEXT_NODE]),n.length){for(var s,a=0,l=n.length;l>a;++a)s=n[a],this.getMatchingAncestor(s).element||this.applyToTextNode(s);t[i].setStart(n[0],0),s=n[n.length-1],t[i].setEnd(s,s.length),this.normalize&&this.postApply(n,t[i])}}},undoToRange:function(t){for(var n,i,o,r=t.length;r--;){if(n=t[r].getNodes([e.TEXT_NODE]),n.length)t[r].splitBoundaries(),n=t[r].getNodes([e.TEXT_NODE]);else{var s=t[r].endContainer.ownerDocument,a=s.createTextNode(e.INVISIBLE_SPACE);t[r].insertNode(a),t[r].selectNode(a),n=[a]}for(var l=0,c=n.length;c>l;++l)t[r].isValid()&&(i=n[l],o=this.getMatchingAncestor(i),"style"===o.type?this.undoToTextNode(i,t[r],!1,o.element):o.element&&this.undoToTextNode(i,t[r],o.element));1==c?this.selectNode(t[r],n[0]):(t[r].setStart(n[0],0),i=n[n.length-1],t[r].setEnd(i,i.length),this.normalize&&this.postApply(n,t[r]))}},selectNode:function(t,n){var i=n.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in n?n.canHaveHTML:!0,r=i?n.innerHTML:n.data,s=""===r||r===e.INVISIBLE_SPACE;if(s&&i&&o)try{n.innerHTML=e.INVISIBLE_SPACE}catch(a){}t.selectNodeContents(n),s&&i?t.collapse(!1):s&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var i=n.intersection(t),o=i?i.toString():"";return n.detach(),o},isAppliedToRange:function(t){for(var n,i,o=[],r="full",s=t.length;s--;){if(i=t[s].getNodes([e.TEXT_NODE]),!i.length)return n=this.getMatchingAncestor(t[s].startContainer).element,n?{elements:[n],coverage:r}:!1;for(var a,l=0,c=i.length;c>l;++l)a=this.getTextSelectedByRange(i[l],t[s]),n=this.getMatchingAncestor(i[l]).element,n&&""!=a?(o.push(n),1===e.dom.getTextNodes(n,!0).length?r="full":"full"===r&&(r="inline")):n||(r="partial")}return o.length?{elements:o,coverage:r}:!1},toggleRange:function(e){var t,n=this.isAppliedToRange(e);n?"full"===n.coverage?this.undoToRange(e):"inline"===n.coverage?(t=d(n.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),t||this.applyToRange(e)):(d(n.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},e.selection.HTMLApplier=v}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),o=n&&n.exec,r=null;if(this.editor.fire("beforecommand:composer"),o)i.unshift(this.composer),r=o.apply(n,i);else try{r=this.doc.execCommand(e,!1,t)}catch(s){}return this.editor.fire("aftercommand:composer"),r},state:function(e){var t=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),i=t&&t.state;if(i)return n.unshift(this.composer),i.apply(t,n);try{return this.doc.queryCommandState(e)}catch(o){return!1}},stateValue:function(e){var t=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),i=t&&t.stateValue;return i?(n.unshift(this.composer),i.apply(t,n)):!1}}),wysihtml5.commands.inline={exec:function(e,t,n){if(!e.config.formats[n])return!1;var i="undefined"!=typeof e.config.formats[n]["class"]?e.config.formats[n]["class"]:null;wysihtml5.commands.formatInline.execWithToggle(e,t,"undefined"!==e.config.formats[n].tag?e.config.formats[n].tag:"span",i,i)},state:function(e,t,n){if(!e.config.formats[n])return!1;var i="undefined"!==e.config.formats[n]?e.config.formats[n]["class"]:null;return wysihtml5.commands.formatInline.state(e,t,"undefined"!==e.config.formats[n].tag?e.config.formats[n].tag:"span",i,i)}},function(e){function t(t,n){var s,a,l,c,d,u,h,f,m,g=t.doc,p="_wysihtml5-temp-"+ +new Date,y=/non-matching-class/g,v=0;for(e.commands.formatInline.exec(t,i,o,p,y,i,i,!0,!0),a=g.querySelectorAll(o+"."+p),s=a.length;s>v;v++){l=a[v],l.removeAttribute("class");for(m in n)"text"!==m&&l.setAttribute(m,n[m])}u=l,1===s&&(h=r.getTextContent(l),c=!!l.querySelector("*"),d=""===h||h===e.INVISIBLE_SPACE,!c&&d&&(r.setTextContent(l,n.text||l.href),f=g.createTextNode(" "),t.selection.setAfter(l),r.insert(f).after(l),u=f)),t.selection.setAfter(u)}function n(e,t,n){for(var i,o=t.length;o--;){i=t[o].attributes;for(var r=i.length;r--;)t[o].removeAttribute(i.item(r).name);for(var s in n)n.hasOwnProperty(s)&&t[o].setAttribute(s,n[s])}}var i,o="A",r=e.dom;e.commands.createLink={exec:function(e,i,o){var r=this.state(e,i);r?e.selection.executeAndRestore(function(){n(e,r,o)}):(o="object"==typeof o?o:{href:o},t(e,o))},state:function(t,n){var i;t.doc;return i=t.selection.getSelectedNode(),i&&"A"===i.tagName&&"IMG"===i.firstElementChild.tagName?!1:e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),function(e){function t(e,t){for(var i,o,r,s=t.length,a=0;s>a;a++)i=t[a],o=n.getParentElement(i,{nodeName:"code"}),r=n.getTextContent(i),r.match(n.autoLink.URL_REG_EXP)&&!o?o=n.renameElement(i,"code"):n.replaceWithChildNodes(i)}var n=e.dom;e.commands.removeLink={exec:function(e,n){var i=this.state(e,n);i&&e.selection.executeAndRestore(function(){t(e,i)})},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),wysihtml5.commands.fontSize={exec:function(e,t,n){wysihtml5.commands.formatInline.execWithToggle(e,t,"span",wysihtml5.classes.size_font[n],wysihtml5.classes.size_font.REG_EXP)},state:function(e,t,n){return wysihtml5.commands.formatInline.state(e,t,"span",wysihtml5.classes.size_font[n],wysihtml5.classes.size_font.REG_EXP)}},wysihtml5.commands.fontSizeStyle={REG_EXP:/(\s|^)font-size\s*:\s*[^;\s]+;?/gi,exec:function(e,t,n){n="object"==typeof n?n.size:n,/^\s*$/.test(n)||wysihtml5.commands.formatInline.execWithToggle(e,t,"span",!1,!1,"font-size:"+n,this.REG_EXP)},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"span",!1,!1,"font-size",this.REG_EXP)},stateValue:function(e,t){var n,i=this.state(e,t);return i&&wysihtml5.lang.object(i).isArray()&&(i=i[0]),i&&(n=i.getAttribute("style"))?wysihtml5.quirks.styleParser.parseFontSize(n):!1}},function(e){e.commands.foreColor={exec:function(t,n,i){e.commands.formatInline.execWithToggle(t,n,"span",e.classes.foreColor[i],e.classes.foreColor.REG_EXP)},state:function(t,n,i){
return e.commands.formatInline.state(t,n,"span",e.classes.foreColor[i],e.classes.foreColor.REG_EXP)}}}(wysihtml5),function(e){var t=/color: rgb\((.*?)\)/g,n=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi,i=function(t,n){var i,o=e.quirks.styleParser.parseColor("object"==typeof t?n+"color:"+t.color:n+"color:"+t,n+"color");return o?(i=n+"color: rgb("+o[0]+","+o[1]+","+o[2]+");",1!==o[3]&&(i+=n+"color: rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+");"),i):void 0},o=function(t,n,i){var o,r=!1;return t&&e.lang.object(t).isArray()&&(t=t[0]),t&&(o=t.getAttribute("style"))?(r=e.quirks.styleParser.parseColor(o,n+"color"),e.quirks.styleParser.unparseColor(r,i)):!1};e.commands.foreColorStyle={exec:function(n,o,r){var s=i(r,"");s&&(console.log(s),e.commands.formatInline.execWithToggle(n,o,"span",!1,!1,s,t))},state:function(n,i){return e.commands.formatInline.state(n,i,"span",!1,!1,"color",t)},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"color"})},stateValue:function(e,t,n){return o(this.state(e,t),"",n)}},e.commands.bgColorStyle={exec:function(t,o,r){var s=i(r,"background-");s&&e.commands.formatInline.execWithToggle(t,o,"span",!1,!1,s,n)},remove:function(t,n){return e.commands.formatInline.remove(t,n,{styleProperty:"background-color"})},state:function(t,i){return e.commands.formatInline.state(t,i,"span",!1,!1,"background-color",n)},stateValue:function(e,t,n){return o(this.state(e,t),"background-",n)}}}(wysihtml5),function(e){function t(t,n,o){t.className?(i(t,o),t.className=e.lang.string(t.className+" "+n).trim()):t.className=n}function n(t,n,i){o(t,i),t.getAttribute("style")?t.setAttribute("style",e.lang.string(t.getAttribute("style")+" "+n).trim()):t.setAttribute("style",n)}function i(t,n){var i=n.test(t.className);return t.className=t.className.replace(n,""),""==e.lang.string(t.className).trim()&&t.removeAttribute("class"),i}function o(t,n){var i=n.test(t.getAttribute("style"));return t.setAttribute("style",(t.getAttribute("style")||"").replace(n,"")),""==e.lang.string(t.getAttribute("style")||"").trim()&&t.removeAttribute("style"),i}function r(e){var t=e.lastChild;t&&s(t)&&t.parentNode.removeChild(t)}function s(e){return"BR"===e.nodeName}function a(t,n){t.selection.isCollapsed()&&t.selection.selectLine();for(var i=t.selection.surround(n),o=0,s=i.length;s>o;o++)e.dom.lineBreaks(i[o]).remove(),r(i[o])}function l(t){return!!e.lang.string(t.className).trim()}function c(t){return!!e.lang.string(t.getAttribute("style")||"").trim()}var d=e.dom,u=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];e.commands.formatBlock={exec:function(r,s,h,f,m,g,p){var y,v,w,b,C,N=(r.doc,this.state(r,s,h,f,m,g,p)),E=r.config.useLineBreaks,x=E?"DIV":"P";return h="string"==typeof h?h.toUpperCase():h,N.length?void r.selection.executeAndRestoreRangy(function(){for(var t=N.length;t--;){if(m&&(v=i(N[t],m)),p&&(b=o(N[t],p)),(b||v)&&null===h&&N[t].nodeName!=x)return;var n=l(N[t]),r=c(N[t]);n||r||!E&&"P"!==h?d.renameElement(N[t],"P"===h?"DIV":x):(e.dom.lineBreaks(N[t]).add(),d.replaceWithChildNodes(N[t]))}}):void((null===h||e.lang.array(u).contains(h))&&(y=r.selection.findNodesInSelection(u).concat(r.selection.getSelectedOwnNodes()),r.selection.executeAndRestoreRangy(function(){for(var e=y.length;e--;)C=d.getParentElement(y[e],{nodeName:u}),C==r.element&&(C=null),C&&(h&&(C=d.renameElement(C,h)),f&&t(C,f,m),g&&n(C,g,p),w=!0)}),w)||a(r,{nodeName:h||x,className:f||null,cssStyle:g||null}))},state:function(t,n,i,o,r,s,a){var l,c=t.selection.getSelectedOwnNodes(),u=[];i="string"==typeof i?i.toUpperCase():i;for(var h=0,f=c.length;f>h;h++)l=d.getParentElement(c[h],{nodeName:i,className:o,classRegExp:r,cssStyle:s,styleRegExp:a}),l&&-1==e.lang.array(u).indexOf(l)&&u.push(l);return 0==u.length?!1:u}}}(wysihtml5),wysihtml5.commands.formatCode={exec:function(e,t,n){var i=this.state(e);if(i)e.selection.executeAndRestore(function(){code=i.querySelector("code"),wysihtml5.dom.replaceWithChildNodes(i),code&&wysihtml5.dom.replaceWithChildNodes(code)});else{if(!n.code)return;e.commands.exec("insertHTML","\n<pre><code"+(n.className?' class="'+n.className+'"':"")+">"+wysihtml5.lang.string(n.code).escapeHTML()+"</code></pre>\n")}},state:function(e){var t=e.selection.getSelectedNode();return t&&t.nodeName&&"PRE"==t.nodeName&&t.firstChild&&t.firstChild.nodeName&&"CODE"==t.firstChild.nodeName?t:wysihtml5.dom.getParentElement(t,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(t,{nodeName:"PRE"})}},function(e){function t(e){var t=i[e];return t?[e.toLowerCase(),t.toLowerCase()]:[e.toLowerCase()]}function n(n,i,r,s,a,l){var c=n;return i&&(c+=":"+i),s&&(c+=":"+s),o[c]||(o[c]=new e.selection.HTMLApplier(t(n),i,r,!0,s,a,l)),o[c]}var i={strong:"b",em:"i",b:"strong",i:"em"},o={};e.commands.formatInline={exec:function(e,t,i,o,r,s,a,l,c){var d=e.selection.createRange(),u=e.selection.getOwnRanges();return u&&0!=u.length?(e.selection.getSelection().removeAllRanges(),n(i,o,r,s,a,e.element).toggleRange(u),void(l?c||e.cleanUp():(d.setStart(u[0].startContainer,u[0].startOffset),d.setEnd(u[u.length-1].endContainer,u[u.length-1].endOffset),e.selection.setSelection(d),e.selection.executeAndRestore(function(){c||e.cleanUp()},!0,!0)))):!1},execWithToggle:function(t,n,i,o,r,s,a){var l=this,c=null;if(this.state(t,n,i,o,r,s,a)&&t.selection.isCollapsed()&&!t.selection.caretIsLastInSelection()&&!t.selection.caretIsFirstInSelection()){var d=l.state(t,n,i,o,r)[0];t.selection.executeAndRestoreRangy(function(){d.parentNode;t.selection.selectNode(d,!0),e.commands.formatInline.exec(t,n,i,o,r,s,a,!0,!0)})}else this.state(t,n,i,o,r,s,a)&&!t.selection.isCollapsed()?t.selection.executeAndRestoreRangy(function(){e.commands.formatInline.exec(t,n,i,o,r,s,a,!0,!0)}):e.commands.formatInline.exec(t,n,i,o,r,s,a);c=t.selection.getRange(),c.collapse(),t.selection.setSelection(c)},state:function(t,o,r,s,a,l,c){var d,u,h=t.doc,f=i[r]||r;return e.dom.hasElementWithTagName(h,r)||e.dom.hasElementWithTagName(h,f)?s&&!e.dom.hasElementWithClassName(h,s)?!1:(d=t.selection.getOwnRanges(),d&&0!==d.length?(u=n(r,s,a,l,c,t.element).isAppliedToRange(d),u&&u.elements?u.elements:!1):!1):!1}}}(wysihtml5),wysihtml5.commands.insertBlockQuote={exec:function(e,t){var n,i=this.state(e,t),o=e.selection.getSelectedNode(),r=e.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);i||!i&&"#text"!==o.nodeName?e.selection.executeAndRestore(function(){if(i)e.config.useLineBreaks&&wysihtml5.dom.lineBreaks(i).add(),wysihtml5.dom.unwrap(i);else if(e.selection.isCollapsed()&&e.selection.selectLine(),r){var t=r.ownerDocument.createElement("blockquote");wysihtml5.dom.insert(t).after(r),t.appendChild(r)}else e.selection.surround({nodeName:"blockquote"})}):(n=wysihtml5.dom.getBlockParentNode(o),n.outerHTML="<blockquote>"+n.outerHTML+"</blockquote>")},state:function(e){var t=e.selection.getSelectedNode(),n=wysihtml5.dom.getParentElement(t,{nodeName:"BLOCKQUOTE"},!1,e.element);return n?n:!1}},wysihtml5.commands.insertHTML={exec:function(e,t,n){var i,o,r=e.selection.getSelectedNode(),s="string"==typeof n&&!n.match(/<[^>]*>/g)&&"function"==typeof insertTemplate[n],a=s?insertTemplate[n]():n,l="outerHTML";r&&r!==e.element?(i=wysihtml5.dom.getBlockParentNode(r),o=(i?i:r).ownerDocument.createElement("div"),wysihtml5.classes.insertTemplateWrapper&&(wysihtml5.dom.addClass(o,wysihtml5.classes.insertTemplateWrapper),l="innerHTML"),i?i===e.element?i.appendChild(o):i.parentNode.insertBefore(o,i.nextSibling):r.parentNode.appendChild(o),o[l]=a):("undefined"!=typeof wysihtml5.classes.insertTemplateWrapper&&(a='<div class="'+wysihtml5.classes.insertTemplateWrapper+'">'+a+"</div>"),e.commands.support(t)?e.doc.execCommand(t,!1,a):e.selection.insertHTML(a)),e.parent.fire("insert:composer",{handler:s?n:null,value:a})},state:function(){return!1}},function(e){var t="IMG";e.commands.insertImage={exec:function(n,i,o){o="object"==typeof o?o:{src:o};var r,s,l,c,d=n.doc,u=n.selection.getSelectedNode(),h=this.state(n),f=u?this.getFigure(n,u):"",m=o&&o.className.length?o.className:"",g=m?o.className[0]:"",p=u?e.dom.getBlockParentNode(u):"";if(h)return e.dom.removeClass(h,e.classes.image.responsive),n.selection.setBefore(h),c=h.parentNode,c.removeChild(h),e.dom.removeEmptyTextNodes(c),"A"!==c.nodeName||c.firstChild||(n.selection.setAfter(c),c.parentNode.removeChild(c)),e.quirks.redraw(n.element),void d.activeElement.blur();if(h=d.createElement(t),o.caption&&g&&(l=g,delete o.className[0],o.className.length--),Object.keys(o).forEach(function(e){"className"===e&&o[e].length?h.className=o[e].join(" ").trim():"href"!==e&&"target"!==e&&"caption"!==e&&"className"!==e&&(h[e]=o[e])}),o.caption){s=f?f:d.createElement("figure"),l&&(s.className+=l);var y=f?f.getElementsByTagName("figcaption"):"";y=y?y[0]:d.createElement("figcaption"),y.textContent=o.caption,o.href?s.innerHTML='<a href="'+o.href+'"'+(o.target?' target="'+o.target+'"':"")+">"+h.outerHTML+"</a>"+y.outerHTML:s.innerHTML=h.outerHTML+y.outerHTML}else o.href?(s=d.createElement("a"),s.href=o.href,o.target&&(a.target=o.target),s.innerHTML=h.outerHTML):s=h;o.caption&&!f?p?p.parentNode.insertBefore(s,p.nextSibling):n.selection.insertHTML(s.outerHTML):(n.selection.insertNode(s),e.browser.hasProblemsSettingCaretAfterImg()?(r=d.createTextNode(e.INVISIBLE_SPACE),n.selection.insertNode(r),n.selection.setAfter(r)):n.selection.setAfter(s))},state:function(n){var i,o,r,s=n.doc;return e.dom.hasElementWithTagName(s,t)&&(i=n.selection.getSelectedNode())?i.nodeName===t?i:i.nodeType!==e.ELEMENT_NODE?!1:(o=n.selection.getText(),(o=e.lang.string(o).trim())?!1:(r=n.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==r.length?!1:r[0])):!1},getFigure:function(t,n){return"figure"===n.nodeName?n:"figure"===n.parentNode?n.parentNode:e.dom.closest(n.parentNode,"figure")}}}(wysihtml5),wysihtml5.commands.insertVideo={exec:function(e,t,n){var i,o=e.doc;n&&"object"==typeof n&&(i=this.createVideo(n.url,o)),i&&(n.className&&wysihtml5.dom.addClass(i,n.className),e.selection.insertNode(i),e.selection.setAfter(i))},createVideo:function(e,t){if(!e)return!1;var n,i,o=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/,r=e.match(o),s=/(?:www\.|\/\/)instagram\.com\/p\/(.[a-zA-Z0-9_-]*)/,a=e.match(s),l=/\/\/(player\.)?vimeo\.com\/([a-z]*\/)*([0-9]{6,11})[?]?.*/,c=e.match(l),d=/.+dailymotion.com\/(video|hub)\/([^_]+)[^#]*(#video=([^_&]+))?/,u=e.match(d),h=/^.+.(mp4|m4v)$/,f=e.match(h),m=/^.+.(ogg|ogv)$/,g=e.match(m),p=/^.+.(webm)$/,y=e.match(p);if(r&&11===r[1].length)n=t.createElement("iframe"),n.setAttribute("frameborder",0),n.setAttribute("allowfullscreen","true"),n.src="//www.youtube.com/embed/"+r[1],n.width=640,n.height=360;else if(a&&a[0].length)n=t.createElement("iframe"),n.setAttribute("frameborder",0),n.setAttribute("scrolling","no"),n.setAttribute("allowtransparency","true"),n.src="https://instagram.com/p/"+a[1]+"/embed/",n.width=612,n.height=710;else if(c&&c[3].length)n=t.createElement("iframe"),n.setAttribute("frameborder",0),n.setAttribute("allowfullscreen","true"),n.src="//player.vimeo.com/video/"+c[3],n.width=640,n.height=360;else if(u&&u[2].length)n=t.createElement("iframe"),n.setAttribute("frameborder",0),n.setAttribute("allowfullscreen","true"),n.src="//www.dailymotion.com/embed/video/"+u[2],n.width=640,n.height=360;else{if(!(f||g||y))return!1;n=t.createElement("video"),n.src=e,n.width=640,n.height=360,n.setAttribute("controls","true")}return i=t.createElement("div"),i.appendChild(n),wysihtml5.dom.addClass(i,wysihtml5.classes.video.wrapper),i}},wysihtml5.commands.insertLineBreak={exec:function(e,t){e.commands.support(t)?(e.doc.execCommand(t,!1,null),wysihtml5.browser.autoScrollsToCaret()||e.selection.scrollIntoView()):e.commands.exec("insertHTML","<br>"+(wysihtml5.browser.needsSpaceAfterLineBreak()?" ":""))},state:function(){return!1}},wysihtml5.commands.insertHorizontalRule={exec:function(e){e.commands.exec("insertHTML","<hr>")},state:function(){return!1}},wysihtml5.commands.insertOrderedList={exec:function(e,t){wysihtml5.commands.insertList.exec(e,t,"OL")},state:function(e,t){return wysihtml5.commands.insertList.state(e,t,"OL")}},wysihtml5.commands.insertUnorderedList={exec:function(e,t){wysihtml5.commands.insertList.exec(e,t,"UL")},state:function(e,t){return wysihtml5.commands.insertList.state(e,t,"UL")}},wysihtml5.commands.insertList=function(e){var t=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},n=function(n,i,o){var r={el:null,other:!1};if(n){var s=e.dom.getParentElement(n,{nodeName:"LI"}),a="UL"===i?"OL":"UL";t(n,i)?r.el=n:t(n,a)?r={el:n,other:!0}:s&&(t(s.parentNode,i)?r.el=s.parentNode:t(s.parentNode,a)&&(r={el:s.parentNode,other:!0}))}return r.el&&!o.element.contains(r.el)&&(r.el=null),r},i=function(t,n,i){var o,s="UL"===n?"OL":"UL";i.selection.executeAndRestore(function(){var a=r(s,i);if(a.length)for(var l=a.length;l--;)e.dom.renameElement(a[l],n.toLowerCase());else{o=r(["OL","UL"],i);for(var c=o.length;c--;)e.dom.resolveList(o[c],i.config.useLineBreaks);e.dom.resolveList(t,i.config.useLineBreaks)}})},o=function(t,n,i){var o="UL"===n?"OL":"UL";i.selection.executeAndRestore(function(){for(var s=[t].concat(r(o,i)),a=s.length;a--;)e.dom.renameElement(s[a],n.toLowerCase())})},r=function(e,n){for(var i=n.selection.getOwnRanges(),o=[],r=i.length;r--;)o=o.concat(i[r].getNodes([1],function(n){return t(n,e)}));return o},s=function(t,n){n.selection.executeAndRestoreRangy(function(){var i,o,r="_wysihtml5-temp-"+(new Date).getTime(),s=n.selection.deblockAndSurround({nodeName:"div",className:r}),a=/\uFEFF/g;s.innerHTML=s.innerHTML.replace(a,""),s&&(i=e.lang.array(["","<br>",e.INVISIBLE_SPACE]).contains(s.innerHTML),o=e.dom.convertToList(s,t.toLowerCase(),e.classes.uneditableContainerClassname),i&&n.selection.selectNode(o.querySelector("li"),!0))})};return{exec:function(e,t,r){var a=e.doc,l="OL"===r?"insertOrderedList":"insertUnorderedList",c=e.selection.getSelectedNode(),d=n(c,r,e);d.el?d.other?o(d.el,r,e):i(d.el,r,e):e.commands.support(l)?a.execCommand(l,!1,null):s(r,e)},state:function(e,t,i){var o=e.selection.getSelectedNode(),r=n(o,i,e);return r.el&&!r.other?r.el:!1}}}(wysihtml5),wysihtml5.commands.blockStyle={exec:function(e,t,n){var i=n.split(":"),o=e.config.addStyles[i[0]];return wysihtml5.commands.formatBlock.exec(e,"formatBlock",null,o.options[i[1]],o.REG_EXP)},state:function(e,t,n){var i=n.split(":"),o=e.config.addStyles[i[0]];return wysihtml5.commands.formatBlock.state(e,"formatBlock",null,o.options[i[1]],o.REG_EXP)}},wysihtml5.commands.inlineStyle={exec:function(e,t,n){var i=n.split(":"),o=e.config.addStyles[i[0]],r="undefined"!=typeof o.tag?o.tag:"span";return wysihtml5.commands.formatInline.execWithToggle(e,t,r,o.options[i[1]],o.REG_EXP)},state:function(e,t,n){var i=n.split(":"),o=e.config.addStyles[i[0]],r="undefined"!=typeof o.tag?o.tag:"span";return wysihtml5.commands.formatInline.state(e,t,r,o.options[i[1]],o.REG_EXP)}},wysihtml5.commands.indent={exec:function(e){return wysihtml5.commands.formatBlock.exec(e,"formatBlock",null,wysihtml5.classes.indent,new RegExp(wysihtml5.classes.indent))},state:function(e){return wysihtml5.commands.formatBlock.state(e,"formatBlock",null,wysihtml5.classes.indent,new RegExp(wysihtml5.classes.indent))}},wysihtml5.commands.align={exec:function(e,t,n){return wysihtml5.commands.formatBlock.exec(e,"formatBlock",null,wysihtml5.classes.align_text[n],wysihtml5.classes.align_text.REG_EXP)},state:function(e,t,n){return wysihtml5.commands.formatBlock.state(e,"formatBlock",null,wysihtml5.classes.align_text[n],wysihtml5.classes.align_text.REG_EXP)}},wysihtml5.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(){return!1}},wysihtml5.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(){return!1}},wysihtml5.commands.createTable={buildHeader:function(e){var t="<thead><tr>";for(col=0;col<e;col++)t+="<th>&nbsp;</th>";return t+="</tr></thead>"},buildBody:function(e,t){var n="<tbody>";for(row=0;row<t;row++){for(n+="<tr>",col=0;col<e;col++)n+="<td>&nbsp;</td>";return n+="</tr></tbody>"}},exec:function(e,t,n){var i;e.doc;n&&n.cols&&n.rows&&parseInt(n.cols,10)>0&&parseInt(n.rows,10)>0&&(i=n.style||n.className?n.style&&n.className?'<table class="'+n.style+" "+n.className+'">':n.style?'<table class="'+n.style+'">':'<table class="'+n.className+'">':"<table>",i+=this.buildHeader(n.cols),i+=this.buildBody(n.cols,n.rows),i+="</table>",e.commands.exec("insertHTML",i))},state:function(){return!1}},wysihtml5.commands.addTableHead={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var i=wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end);wysihtml5.dom.table.addCells(i.start,n),setTimeout(function(){e.tableSelection.select(i.start,i.end)},0)}},state:function(){return!1}},wysihtml5.commands.mergeTableCells={exec:function(e,t){e.tableSelection&&e.tableSelection.start&&e.tableSelection.end&&(this.state(e,t)?wysihtml5.dom.table.unmergeCell(e.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(e.tableSelection.start,e.tableSelection.end))},state:function(e){if(e.tableSelection){var t=e.tableSelection.start,n=e.tableSelection.end;if(t&&n&&t==n&&(wysihtml5.dom.getAttribute(t,"colspan")&&parseInt(wysihtml5.dom.getAttribute(t,"colspan"),10)>1||wysihtml5.dom.getAttribute(t,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(t,"rowspan"),10)>1))return[t]}return!1}},wysihtml5.commands.addTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var i=wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end);"before"==n||"above"==n?wysihtml5.dom.table.addCells(i.start,n):"after"!=n&&"below"!=n||wysihtml5.dom.table.addCells(i.end,n),setTimeout(function(){e.tableSelection.select(i.start,i.end)},0)}},state:function(){return!1}},wysihtml5.commands.deleteTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var i,o=wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end),r=wysihtml5.dom.table.indexOf(o.start),s=e.tableSelection.table;wysihtml5.dom.table.removeCells(o.start,n),setTimeout(function(){i=wysihtml5.dom.table.findCell(s,r),i||("row"==n&&(i=wysihtml5.dom.table.findCell(s,{row:r.row-1,col:r.col})),"column"==n&&(i=wysihtml5.dom.table.findCell(s,{row:r.row,col:r.col-1}))),i&&e.tableSelection.select(i,i)},0)}},state:function(){return!1}},wysihtml5.commands.indentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPushLiLevel(t,e.selection):!1},state:function(){return!1},tryToPushLiLevel:function(e,t){var n,i,o,r,s,a=!1;return t.executeAndRestoreRangy(function(){for(var t=e.length;t--;)r=e[t],n="OL"===r.parentNode.nodeName?"OL":"UL",i=r.ownerDocument.createElement(n),o=wysihtml5.dom.domNode(r).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),s=o?o.querySelector("ul, ol"):null,o&&(s?s.appendChild(r):(i.appendChild(r),o.appendChild(i)),a=!0)}),a}},wysihtml5.commands.outdentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPullLiLevel(t,e):!1},state:function(){return!1},tryToPullLiLevel:function(e,t){var n,i,o,r,s,a=!1,l=this;return t.selection.executeAndRestoreRangy(function(){for(var c=e.length;c--;)if(r=e[c],r.parentNode&&(n=r.parentNode,"OL"===n.tagName||"UL"===n.tagName)){if(a=!0,i=wysihtml5.dom.getParentElement(n.parentNode,{nodeName:["OL","UL"]},!1,t.element),o=wysihtml5.dom.getParentElement(n.parentNode,{nodeName:["LI"]},!1,t.element),i&&o)r.nextSibling&&(s=l.getAfterList(n,r),r.appendChild(s)),i.insertBefore(r,o.nextSibling);else{r.nextSibling&&(s=l.getAfterList(n,r),r.appendChild(s));for(var d=r.childNodes.length;d--;)n.parentNode.insertBefore(r.childNodes[d],n.nextSibling);n.parentNode.insertBefore(document.createElement("br"),n.nextSibling),r.parentNode.removeChild(r)}0===n.childNodes.length&&n.parentNode.removeChild(n)}}),a},getAfterList:function(e,t){for(var n=e.nodeName,i=document.createElement(n);t.nextSibling;)i.appendChild(t.nextSibling);return i}},function(e){var t=90,n=89,i=8,o=46,r=25,s="data-wysihtml5-selection-node",a="data-wysihtml5-selection-offset",l=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",e.dom);e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var e,r=this;this.composer.sandbox.getDocument();l.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var i=e.keyCode,o=i===t&&!e.shiftKey,s=i===t&&e.shiftKey||i===n;o?(r.undo(),e.preventDefault()):s&&(r.redo(),e.preventDefault())}}),l.observe(this.element,"keydown",function(t){var n=t.keyCode;n!==e&&(e=n,n!==i&&n!==o||r.transact())}),this.editor.on("newword:composer",function(){r.transact()}).on("beforecommand:composer",function(){r.transact()})},transact:function(){var t,n,i,o,l,c=this.historyStr[this.position-1],d=this.composer.getValue(!1,!1),u=this.element.offsetWidth>0&&this.element.offsetHeight>0;if(d!==c){var h=this.historyStr.length=this.historyDom.length=this.position;h>r&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,u&&(t=this.composer.selection.getRange(),n=t&&t.startContainer?t.startContainer:this.element,i=t&&t.startOffset?t.startOffset:0,n.nodeType===e.ELEMENT_NODE?o=n:(o=n.parentNode,l=this.getChildNodeIndex(o,n)),o.setAttribute(a,i),"undefined"!=typeof l&&o.setAttribute(s,l));var f=this.element.cloneNode(!!d);this.historyDom.push(f),this.historyStr.push(d),o&&(o.removeAttribute(a),o.removeAttribute(s))}},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){this.element.innerHTML="";for(var t=0,n=e.childNodes,i=e.childNodes.length;i>t;t++)this.element.appendChild(n[t].cloneNode(!0));var o,r,l;e.hasAttribute(a)?(o=e.getAttribute(a),l=e.getAttribute(s),r=this.element):(r=this.element.querySelector("["+a+"]")||this.element,o=r.getAttribute(a),l=r.getAttribute(s),r.removeAttribute(a),r.removeAttribute(s)),null!==l&&(r=this.getChildNodeByIndex(r,+l)),this.composer.selection.set(r,o)},getChildNodeIndex:function(e,t){for(var n=0,i=e.childNodes,o=i.length;o>n;n++)if(i[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t,n){var i=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(i=this.parent.parse(i,n!==!1)),i},setValue:function(e,t){t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(n){this.element.innerText=e}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&this.selection&&("BR"===n.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){e._create()},{},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){e._create()}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element))},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets});var n=this.textarea.element;this.editableArea=this.sandbox.getIframe(),t.insert(this.editableArea).after(n)},_create:function(){var i=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new e.Selection(this.parent,this.element,e.classes.uneditableContainerClassname),this.commands=new e.Commands(this.parent),this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,e.classes.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe();var o=this.config.name;o&&(t.addClass(this.element,o),this.config.contentEditableMode||t.addClass(this.editableArea,o)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();var r="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");r&&t.simulatePlaceholder(this.parent,this,r),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||n.isIos()||setTimeout(function(){i.focus(!0)},100),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var i=this,o=n.canDisableAutoLinking(),r=n.doesAutoLinkingInContentEditable();if(o&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!r||r&&o)&&(this.parent.on("newword:composer",function(){t.getTextContent(i.element).match(t.autoLink.URL_REG_EXP)&&i.selection.executeAndRestore(function(n,o){for(var r=i.element.querySelectorAll("."+e.classes.uneditableContainerClassname),s=!1,a=r.length;a--;)e.dom.contains(r[a],o)&&(s=!0);s||t.autoLink(o.parentNode,[e.classes.uneditableContainerClassname])})}),t.observe(this.element,"blur",function(){t.autoLink(i.element,[e.classes.uneditableContainerClassname])}));var s=this.sandbox.getDocument().getElementsByTagName("a"),a=t.autoLink.URL_REG_EXP,l=function(n){var i=e.lang.string(t.getTextContent(n)).trim();return"www."===i.substr(0,4)&&(i="http://"+i),i};t.observe(this.element,"keydown",function(e){if(s.length){var n,o=i.selection.getSelectedNode(e.target.ownerDocument),r=t.getParentElement(o,{nodeName:"A"},4);r&&(n=l(r),setTimeout(function(){var e=l(r);e!==n&&e.match(a)&&r.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),n.supportsEvent("resizeend")){var i=["width","height"],o=i.length,r=this.element;t.observe(r,"resizeend",function(t){var n,s=t.target||t.srcElement,a=s.style,l=0;if("IMG"===s.nodeName){for(;o>l;l++)n=i[l],a[n]&&(s.setAttribute(n,parseInt(a[n],10)),a[n]="");e.quirks.redraw(r)}})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function i(e){var n=t.getParentElement(e,{nodeName:["P","DIV"]},2);n&&t.contains(o.element,n)&&o.selection.executeAndRestore(function(){o.config.useLineBreaks?t.replaceWithChildNodes(n):"P"!==n.nodeName&&t.renameElement(n,"p")})}var o=this,r=["LI","P","H1","H2","H3","H4","H5","H6"],s=["CODE","PRE"],a=["UL","OL","MENU"];this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(o.isEmpty()){var e=o.doc.createElement("P");o.element.innerHTML="",o.element.appendChild(e),n.displaysCaretInEmptyContentEditableCorrectly()?o.selection.selectNode(e,!0):(e.innerHTML="<br>",o.selection.setBefore(e.firstChild))}}),t.observe(this.element,"keydown",function(n){var l=n.keyCode;if(!n.shiftKey&&(l===e.ENTER_KEY||l===e.BACKSPACE_KEY)){var c=t.getParentElement(o.selection.getSelectedNode(),{nodeName:s},4);if(c&&l===e.ENTER_KEY)return n.preventDefault(),void o.commands.exec("insertHTML","\n");var d=t.getParentElement(o.selection.getSelectedNode(),{nodeName:r},4);return d?void setTimeout(function(){var n,r=o.selection.getSelectedNode();if("LI"===d.nodeName){if(!r)return;n=t.getParentElement(r,{nodeName:a},2),n||i(r)}l===e.ENTER_KEY&&d.nodeName.match(/^H[1-6]$/)&&i(r)},0):void(o.config.useLineBreaks&&l===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(n.preventDefault(),o.commands.exec("insertLineBreak")))}})}})}(wysihtml5),function(e){var t=e.dom,n=document,i=window,o=n.createElement("div"),r=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],s=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],a=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],l=function(e){
if(e.setActive)try{e.setActive()}catch(o){}else{var r=e.style,s=n.documentElement.scrollTop||n.body.scrollTop,a=n.documentElement.scrollLeft||n.body.scrollLeft,l={position:r.position,top:r.top,left:r.left,WebkitUserSelect:r.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(l).on(e),i.scrollTo&&i.scrollTo(a,s)}};e.views.Composer.prototype.style=function(){var i,c=this,d=n.querySelector(":focus"),u=this.textarea.element,h=u.hasAttribute("placeholder"),f=h&&u.getAttribute("placeholder"),m=u.style.display,g=u.disabled;this.focusStylesHost=o.cloneNode(!1),this.blurStylesHost=o.cloneNode(!1),this.disabledStylesHost=o.cloneNode(!1),h&&u.removeAttribute("placeholder"),u===d&&u.blur(),u.disabled=!1,u.style.display=i="none",(u.getAttribute("rows")&&"auto"===t.getStyle("height").from(u)||u.getAttribute("cols")&&"auto"===t.getStyle("width").from(u))&&(u.style.display=i=m),t.copyStyles(s).from(u).to(this.editableArea).andTo(this.blurStylesHost),t.copyStyles(r).from(u).to(this.element).andTo(this.blurStylesHost),t.insertCSS(a).into(this.element.ownerDocument),u.disabled=!0,t.copyStyles(s).from(u).to(this.disabledStylesHost),t.copyStyles(r).from(u).to(this.disabledStylesHost),u.disabled=g,u.style.display=m,l(u),u.style.display=i,t.copyStyles(s).from(u).to(this.focusStylesHost),t.copyStyles(r).from(u).to(this.focusStylesHost),u.style.display=m,t.copyStyles(["display"]).from(u).to(this.editableArea);var p=e.lang.array(s).without(["display"]);return d?d.focus():u.blur(),h&&u.setAttribute("placeholder",f),this.parent.on("focus:composer",function(){t.copyStyles(p).from(c.focusStylesHost).to(c.editableArea),t.copyStyles(r).from(c.focusStylesHost).to(c.element)}),this.parent.on("blur:composer",function(){t.copyStyles(p).from(c.blurStylesHost).to(c.editableArea),t.copyStyles(r).from(c.blurStylesHost).to(c.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(p).from(c.disabledStylesHost).to(c.editableArea),t.copyStyles(r).from(c.disabledStylesHost).to(c.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(p).from(c.blurStylesHost).to(c.editableArea),t.copyStyles(r).from(c.blurStylesHost).to(c.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,i={66:"bold",73:"italic",85:"underline"},o=function(e,t,n){var i=e.getPreviousNode(t,!0),o=e.getSelectedNode();if(1!==o.nodeType&&o.parentNode!==n&&(o=o.parentNode),i)if(1==o.nodeType){var r=o.firstChild;if(1==i.nodeType)for(;o.firstChild;)i.appendChild(o.firstChild);else for(;o.firstChild;)t.parentNode.insertBefore(o.firstChild,t);o.parentNode&&o.parentNode.removeChild(o),e.setBefore(r)}else 1==i.nodeType?i.appendChild(o):t.parentNode.insertBefore(o,t),e.setBefore(o)},r=function(e,t,n,i){if(t.isCollapsed())if(t.caretIsInTheBeginnig("LI"))e.preventDefault(),i.commands.exec("outdentList");else if(t.caretIsInTheBeginnig())e.preventDefault();else{if(t.caretIsFirstInSelection()&&t.getPreviousNode()&&t.getPreviousNode().nodeName&&/^H\d$/gi.test(t.getPreviousNode().nodeName)){var r=t.getPreviousNode();if(e.preventDefault(),/^\s*$/.test(r.textContent||r.innerText))r.parentNode.removeChild(r);else{var s=r.ownerDocument.createRange();s.selectNodeContents(r),s.collapse(!1),t.setSelection(s)}}var a=t.caretIsBeforeUneditable();a&&(e.preventDefault(),o(t,a,n))}else t.containsUneditable()&&(e.preventDefault(),t.deleteContents())},s=function(e){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("LI")&&e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")};e.views.Composer.prototype.observe=function(){var o=this,a=this.getValue(!1,!1),l=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),c=this.element,d=n.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?c:this.sandbox.getWindow(),u=["drop","paste","beforepaste"],h=["drop","paste","mouseup","focus","keyup"];if(t.observe(l,"DOMNodeRemoved",function(){clearInterval(f),o.parent.fire("destroy:composer")}),!n.supportsMutationEvents())var f=setInterval(function(){t.contains(document.documentElement,l)||(clearInterval(f),o.parent.fire("destroy:composer"))},250);if(t.observe(d,h,function(){setTimeout(function(){o.parent.fire("interaction").fire("interaction:composer",d)},1)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&e.browser.supportsCommand(this.doc,"enableObjectResizing")&&e.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=t.observe(l,["focus","mouseup","mouseover"],function(){o.doc.execCommand("enableObjectResizing",!1,"false"),o.doc.execCommand("enableInlineTableEditing",!1,"false"),o.tableClickHandle.stop()}):setTimeout(function(){o.doc.execCommand("enableObjectResizing",!1,"false"),o.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=e.quirks.tableCellsSelection(c,o.parent)),t.observe(d,"focus",function(e){o.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){a=o.getValue(!1,!1)},0)}),t.observe(d,"blur",function(e){if(a!==o.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),o.parent.fire("change",t).fire("change:composer",t)}o.parent.fire("blur",e).fire("blur:composer",e)}),t.observe(c,"dragenter",function(){o.parent.fire("unset_placeholder")}),t.observe(c,u,function(e){o.parent.fire(e.type,e).fire(e.type+":composer",e)}),t.observe(c,"keyup",function(t){var n=t.keyCode;n!==e.SPACE_KEY&&n!==e.ENTER_KEY||o.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){o.parent.fire("newword:composer")},0)}),!n.canSelectImagesInContentEditable()){var m=document.documentMode||/Edge/.test(navigator.userAgent)?"click":"mousedown";t.observe(c,m,function(t){var n=t.target,i=c.querySelectorAll("img"),r=c.querySelectorAll("."+e.classes.uneditableContainerClassname+" img"),s=e.lang.array(i).without(r);"IMG"===n.nodeName&&e.lang.array(s).contains(n)&&o.selection.selectNode(n)})}n.canSelectImagesInContentEditable()||t.observe(c,"drop",function(){setTimeout(function(){o.selection.getSelection().removeAllRanges()},0)}),n.hasHistoryIssue()&&n.supportsSelectionModify()&&t.observe(c,"keydown",function(e){if(e.metaKey||e.ctrlKey){var t=e.keyCode,n=c.ownerDocument.defaultView,i=n.getSelection();37!==t&&39!==t||(37===t&&(i.modify("extend","left","lineboundary"),e.shiftKey||i.collapseToStart()),39===t&&(i.modify("extend","right","lineboundary"),e.shiftKey||i.collapseToEnd()),e.preventDefault())}}),t.observe(c,"keydown",function(e){var t=e.keyCode,n=i[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&n&&(o.commands.exec("inline",n),e.preventDefault()),8===t?r(e,o.selection,c,o):o.config.handleTabKey&&9===t&&(e.preventDefault(),s(o,c))}),t.observe(c,"keydown",function(t){var n,i=o.selection.getSelectedNode(!0),r=t.keyCode;!i||"IMG"!==i.nodeName||r!==e.BACKSPACE_KEY&&r!==e.DELETE_KEY||(n=i.parentNode,n.removeChild(i),"A"!==n.nodeName||n.firstChild||n.parentNode.removeChild(n),setTimeout(function(){e.quirks.redraw(c)},0),t.preventDefault())}),!this.config.contentEditableMode&&n.hasIframeFocusIssue()&&(t.observe(l,"focus",function(){setTimeout(function(){o.doc.querySelector(":focus")!==o.element&&o.focus()},0)}),t.observe(this.element,"blur",function(){setTimeout(function(){o.selection.getSelection().removeAllRanges()},0)}))}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var n,i=this,o=this.textarea.element.form,r=function(){n=setInterval(function(){i.fromComposerToTextarea()},t)},s=function(){clearInterval(n),n=null};r(),o&&(e.dom.observe(o,"submit",function(){i.sync(!0)}),e.dom.observe(o,"reset",function(){setTimeout(function(){i.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"!==e||n?"textarea"===e&&(i.fromComposerToTextarea(!0),s()):(i.fromTextareaToComposer(!0),r())}),this.editor.on("destroy:composer",s)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e!==!1&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(){var e=this.parent.parse(this.element.value);this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value,i=!n;return e&&i||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},i=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){wysihtml5.dom.observe(e,i,function(e){var i=n[e.type]||e.type;t.fire(i).fire(i+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t,n={name:t,style:!0,toolbar:{groupBlock:["h1","h2","h3","h4","h5","h6","p","blockquote","pre"],groupInline:["bold","italic","underline","strikethrough","superscript","subscript"],button:["block","inline","fontSize","colors","lists","align","link","unlink","img","video","table","hr","undo","redo"]},colors:["97,189,109","26,188,156","84,172,210","44,130,201","147,101,184","71,85,119","204,204,204","65,168,95","0,168,133","61,142,185","41,105,176","85,57,130","40,50,78","118,118,118","247,218,100","251,160,38","235,107,86","226,80,65","163,143,132","239,239,239","255,255,255","250,197,28","243,121,52","209,72,65","184,49,47","124,112,107","209,213,216","0,0,0"],formats:{bold:{tag:"strong","class":t},italic:{tag:"em","class":t},underline:{tag:"u","class":t},strikethrough:{tag:"del","class":t},superscript:{tag:"sup"},subscript:{tag:"sub"}},theme:{iconPrefix:"fa",icons:{bold:"fa-bold",style:"fa-paragraph",inline:"fa-bold",italic:"fa-italic",underline:"fa-underline",strikethrough:"fa-strikethrough",superscript:"fa-superscript",subscript:"fa-subscript",link:"fa-link",unlink:"fa-unlink",ol:"fa-list-ol",ul:"fa-list-ul",image:"fa-image",table:"fa-table",colors:"fa-tint",foreColor:"fa-pencil",fontSize:"fa-text-height",video:"fa-video-camera",indent:"fa-indent",hr:"fa-minus",alignLeft:"fa-align-left",alignCenter:"fa-align-center",alignRight:"fa-align-right",alignJustify:"fa-align-justify",html:"fa-code",undo:"fa-undo",redo:"fa-repeat",lock:"fa-lock",unlock:"fa-unlock",fullscreen:"fa-expand",normalscreen:"fa-compress",prev:"fa-chevron-circle-left",next:"fa-chevron-circle-right"},color:t},files:{uploader:t,manager:t,securityKey:t,withCredentials:t},locale:"en",classSet:{align_text:{alignLeft:"wysiwyg-text-align-left",alignCenter:"wysiwyg-text-align-center",alignRight:"wysiwyg-text-align-right",alignJustify:"wysiwyg-text-align-justify",REG_EXP:/wysiwyg-text-align-[0-9a-z]+/g},indent:"wysiwyg-indent",foreColor:{Black:"wysiwyg-color-black",Silver:"wysiwyg-color-silver",Gray:"wysiwyg-color-grey",Maroon:"wysiwyg-color-maroon",Red:"wysiwyg-color-red",Purple:"wysiwyg-color-purple",fuchsia:"wysiwyg-color-fuchsia",Green:"wysiwyg-color-green",Lime:"wysiwyg-color-lime",Olive:"wysiwyg-color-olive",Yellow:"wysiwyg-color-yellow",Navy:"wysiwyg-color-navy",Blue:"wysiwyg-color-blue",Teal:"wysiwyg-color-teal",Aqua:"wysiwyg-color-aqua",Orange:"wysiwyg-color-orange",REG_EXP:/wysiwyg-color-[0-9a-z]+/g},size_font:{"x-small":"wysiwyg-font-size-x-small",small:"wysiwyg-font-size-small",medium:"wysiwyg-font-size-medium",large:"wysiwyg-font-size-large","x-large":"wysiwyg-font-size-x-large","xx-large":"wysiwyg-font-size-xx-large",smaller:"wysiwyg-font-size-smaller",larger:"wysiwyg-font-size-larger",REG_EXP:/wysiwyg-font-size-[0-9a-z\-]+/g},buttons:{btn:"wysihtml5-btn",save:"wysihtml5-btn-save",cancel:"wysihtml5-btn-cancel",choose:"wysihtml5-btn-choose"},table:{classes:{bordered:"wysiwyg-table-bordered",striped:"wysiwyg-table-striped"},responsive:"wysiwyg-table-responsive"},error:"wysihtml5-error",video:{wrapper:"wysiwyg-video",responsive:"responsive"},insertTemplateWrapper:"wysiwyg-insert",image:{"float":{left:"wysiwyg-float-left",right:"wysiwyg-float-right",REG_EXP:/wysiwyg-float-[0-9a-z]+/g},responsive:"responsive"},composerClassName:"wysihtml5-editor",textareaClassName:"wysihtml5-textarea",bodyClassName:"wysihtml5-supported",uneditableContainerClassname:"wysihtml5-uneditable-container"},counter:0,limiter:t,spellcheck:!1,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:e.dom.parse,useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,i){if(this.editableElement="string"==typeof t?document.getElementById(t):t,!this.editableElement)return console.log("Element not found");if(i.theme=e.lang.object({}).merge(n.theme).merge(i.theme).get(),i.toolbar=e.lang.object({}).merge(n.toolbar).merge(i.toolbar).get(),i.files=e.lang.object({}).merge(n.files).merge(i.files).get(),i.formats=e.lang.object({}).merge(n.formats).merge(i.formats).get(),"object"==typeof i.classSet&&(i.classSet.image&&(n.classSet.image=e.lang.object({}).merge(n.classSet.image).merge(i.classSet.image).get(),delete i.classSet.image),i.classSet.table&&(n.classSet.table=e.lang.object({}).merge(n.classSet.table).merge(i.classSet.table).get(),delete i.classSet.table)),e.classes=e.lang.object({}).merge(n.classSet).merge(i.classSet).get(),this.config=e.lang.object({}).merge(n).merge(i).get(),delete this.config.classSet,this._isCompatible=e.browser.supported(),this.editableElement.spellcheck=this.config.spellcheck,"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),!this.config.noTextarea){var o=document.createElement("div");e.dom.addClass(o,"wysihtml5-box"),this.editableElement.parentNode.insertBefore(o,this.editableElement),o.appendChild(this.editableElement),this.textarea=new e.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea,e.dom.addClass(this.editableElement,e.classes.textareaClassName)}if(!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var r=this;return void setTimeout(function(){r.fire("beforeload").fire("load")},0)}e.dom.addClass(document.body,e.classes.bodyClassName),this.composer=new e.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.config.toolbar=e.toolbar.toolbarCreate(this),this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this._isCompatible=!1,this},enable:function(){return this.currentView.enable(),this},destroy:function(){if(this.currentView.disable(),!this.config.noTextarea){this.editableElement.style.display="block",e.dom.removeClass(this.editableElement,e.classes.textareaClassName);var t=this.editableElement.parentNode.querySelector("iframe.wysihtml5-sandbox");t.parentNode.removeChild(t)}return e.dom.removeClass(this.editableElement,"wysihtml5-sandbox"),e.dom.removeClass(this.editableElement,"wysihtml5-editor"),this.config.toolbar.parentNode.removeChild(this.config.toolbar),this.fire("destroy"),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t,n){var i=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,o=this.config.parser(t,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:i,uneditableClass:e.classes.uneditableContainerClassname,clearInternals:n});return"object"==typeof t&&e.quirks.redraw(t),o},_initParser:function(){var t,n=this;e.browser.supportsModenPaste()?this.on("paste:composer",function(i){i.preventDefault(),t=e.dom.getPastedHtml(i),t&&n._cleanAndPaste(t)}):this.on("beforepaste:composer",function(t){t.preventDefault(),e.dom.getPastedHtmlWithDiv(n.composer,function(e){e&&n._cleanAndPaste(e)})})},_isPartialUpdate:function(){var e=!1,t=!1,n=this.composer.editableArea,i=this.composer.selection.getRange(),o=function(e,t){for(var n=e.startContainer;n!==t;){if(n.previousElementSibling)return!1;n=n.parentElement}return 0==e.startOffset};e=o(i,n);var r=function(e,t){for(var n=e.endContainer;n!==t;){if(n.nextElementSibling)return!1;n=n.parentElement}return e.endOffset==e.endContainer.length};t=r(i,n);var s=!(e&&t);return s},_cleanAndPaste:function(t){var n=this._isPartialUpdate(),i=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:e.classes.uneditableContainerClassname});n?(this.composer.selection.deleteContents(),this.composer.selection.insertHTML(i)):this.composer.editableArea.innerHTML=i}})}(wysihtml5),function(e){var t=e.dom,n="wysihtml5-command-dialog-opened",i="wysihtml5-dialog-opened",o="input, select, textarea",r="[data-wysihtml5-dialog-field]",s="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(t,n,i){this.link=t,this.id=n.getAttribute("data-wysihtml5-dialog-id"),this.container=n,this.iframe=i,this.cmd=this.container.getAttribute("data-wysihtml5-dialog"),this.ios=e.browser.isIos(),this.win="undefined"!=typeof this.iframe?this.iframe.contentWindow:window},_observe:function(){if(!this._observed){var i=this,r=function(e){var n=i._serialize();if(n==i.elementToChange){var o=n.offsetParent;o&&t.hasClass(o,"wysihtml5-image-box")&&(o.parentNode.insertBefore(n,o.nextSibling),o.parentNode.removeChild(o)),i.fire("edit",n)}else delete n.file,i.fire("save",n);i.hide(),e.preventDefault(),e.stopPropagation()};t.observe(this.link,"click",function(){t.hasClass(i.link,n)&&setTimeout(function(){i.hide()},0)}),t.observe(this.container,"keydown",function(t){var n=t.keyCode;n===e.ESCAPE_KEY&&(i.fire("cancel"),i.hide())}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",r),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){i.fire("cancel"),i.hide(),e.preventDefault(),e.stopPropagation()});for(var s=this.container.querySelectorAll(o),a=0,l=s.length,c=function(){clearInterval(i.interval)};l>a;a++)t.observe(s[a],"change",c);this._observed=!0}},_serialize:function(){var n,i,o=this.elementToChange||{},a=this.container.querySelectorAll(r),l=a.length,c=this.figure?this.figure.getElementsByTagName("figcaption"):!1,d=!("insertImage"!==this.cmd||!document.getElementById("icap"+this.id).value),u={},h=0;if("insertImage"===this.cmd&&("[object Object]"===Object.prototype.toString.call(o)?o.className=[]:t.removeClass(o,e.classes.image.responsive)),d&&!c.length)var f={};for(;l>h;h++)if(n=a[h],i=n.getAttribute(s),"[object Object]"!==Object.prototype.toString.call(o))if("className"===i)if("insertImage"===this.cmd)if("SELECT"===n.tagName){var m=this.figure?this.figure:o;m.className=o.className.replace(e.classes.image["float"].REG_EXP,"").trim(),n.value&&(this.figure||"undefined"==typeof f?m.className+=e.classes.image["float"][n.value]:f["float"]=e.classes.image["float"][n.value])}else"INPUT"===n.tagName&&"checkbox"===n.type&&n.checked&&t.addClass(o,e.classes.image.responsive);else"PRE"===o.tagName?o.firstElementChild.className=n.value:t.addClass(o,n.value);else{if("insertImage"===this.cmd)switch(i){case"href":this.parent?this.parent[i]=n.value:u[i]=n.value;break;case"target":this.parent?this.parent[i]=n.checked?n.value:"_self":u[i]=n.checked?n.value:"";break;case"caption":n.value?c.length?c[0].textContent=n.value:f[i]=n.value:c.length&&c[0].parentNode.removeChild(c[0])}else"formatCode"===this.cmd&&"code"===i&&(o.firstElementChild.textContent=n.value);"INPUT"!==n.tagName||"checkbox"!==n.type||n.checked?n.value&&(o[i]=n.value):o.removeAttribute(i)}else"insertImage"===this.cmd&&"className"===i?"INPUT"===n.tagName&&"checkbox"===n.type?n.checked&&(o.className[1]=e.classes.image.responsive):n.value&&(o.className[0]=e.classes.image["float"][n.value]):"INPUT"!==n.tagName||"checkbox"!==n.type||n.checked?n.value&&(o[i]=n.value):o[i]="";if("[object Object]"!==Object.prototype.toString.call(o)&&"insertImage"===this.cmd)if(f&&f.caption)if(this.figure){var g=document.createElement("figcaption");g.textContent=f.caption,this.figure.appendChild(g),!this.parent&&u.href&&(o.outerHTML='<a href="'+u.href+'"'+(u.target?' target="'+u.target+'"':"")+">"+o.outerHTML+"</a>")}else{var p=u.href?'<a href="'+u.href+'"'+(u.target?' target="'+u.target+'"':"")+">"+o.outerHTML+"</a>":(this.parent?this.parent:o).outerHTML,y=t.getBlockParentNode(o),v="";y&&(o.previousSibling?y.parentNode.insertBefore(o,y.nextSibling):y.parentNode.insertBefore(o,y),y.innerHTML||(v=y.className||"",y.parentNode.removeChild(y))),v=((f["float"]?f["float"]:"")+" "+v).trim(),o.outerHTML="<figure"+(v?' class="'+v+'"':"")+">"+p+"<figcaption>"+f.caption+"</figcaption></figure>",this.parent&&this.parent.parentNode.removeChild(this.parent)}else!this.parent&&u.href&&(o.outerHTML='<a href="'+u.href+'"'+(u.target?' target="'+u.target+'"':"")+">"+o.outerHTML+"</a>");return o},_isChecked:function(e,t,n,i){var o=e.getAttribute("className"===n?"class":n),r="select"===i?"selected":"checked";return o&&-1!=o.indexOf(t)?r:""},unescapeHTML:function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},_interpolate:function(e){for(var t,n,i,o=document.querySelector(":focus"),a=this.container.querySelectorAll(r),l=a.length,c=0,d=this.figure?this.figure.getElementsByTagName("figcaption"):!1,u=this.elementToChange&&"PRE"===this.elementToChange.tagName?this.elementToChange.firstElementChild:this.elementToChange;l>c;c++)if(t=a[c],t!==o&&(!e||"hidden"!==t.type))if(n=t.getAttribute(s),this.elementToChange&&"object"==typeof this.elementToChange)if(this.parent&&"href"===n)t.value=this.parent.getAttribute(n)||"";else if(this.parent&&"target"===n)i=this.parent.getAttribute(n)||"",t.checked="_blank"===i?"checked":"";else if("code"===n)t.value=this.unescapeHTML(u.textContent||"");else if("caption"===n)t.value=d.length?d[0].textContent:"";else if("checkbox"===t.type)t.checked=this._isChecked(this.elementToChange,t.value,n,t.type);else if("SELECT"===t.tagName)for(var h=0,f=this.figure?this.figure:u;h<t.options.length;h++)t.options[h].selected=this._isChecked(f,t.options[h].value,n,t.type);else t.value=this.elementToChange.getAttribute(n)||"";else t.value=t.defaultValue,"SELECT"===t.tagName?t.firstElementChild.selected="selected":"checkbox"!==t.type&&"radio"!==t.type||(t.checked="")},show:function(e){if(!t.hasClass(this.link,n)){var r=this,s=e?e.parentNode:!1,a=this.container.querySelector(o);this.elementToChange=e,this.parent="insertImage"===this.cmd&&"A"===s.tagName?s:!1,this.figure="insertImage"===this.cmd&&e?t.closest(e,"figure"):!1,this._observe(),this._interpolate(),e&&r._interpolate(!0);var l=this.container,c=l.ownerDocument;if(t.addClass(this.link,n),t.addClass(this.container,"opened"),t.addClass(c.body,i),this.ios){var d=c.scrollTop||c.body.scrollTop;c.body.style.position="fixed",c.body.style.top=-1*d+"px"}if(this.win.onclick=function(e){e.target===l&&(r.fire("cancel"),r.hide())},this.fire("show"),a&&!e)try{a.focus()}catch(u){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,n),t.removeClass(this.container,"opened");var e=this.container.ownerDocument.body;if(this.ios){var o=-e.style.top.replace(/px/g,"");e.style.top="auto",e.style.position="relative",this.win.scrollTo(0,o)}t.removeClass(e,i),this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},i={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},o={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},r={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(s,a){var l=document.createElement("input");if(!e.browser.supportsSpeechApiOn(l))return void(a.style.display="none");var c=s.editor.textarea.element.getAttribute("lang");c&&(r.lang=c);var d=document.createElement("div");e.lang.object(i).merge({width:a.offsetWidth+"px",height:a.offsetHeight+"px"}),t.insert(l).into(d),t.insert(d).into(a),t.setStyles(o).on(l),t.setAttributes(r).on(l),t.setStyles(i).on(d),t.setStyles(n).on(a);var u="onwebkitspeechchange"in l?"webkitspeechchange":"speechchange";t.observe(l,u,function(){s.execCommand("insertText",l.value),l.value=""}),t.observe(l,"click",function(e){t.hasClass(a,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}}(wysihtml5),function(e){var t="wysihtml5-command-disabled",n="wysihtml5-commands-disabled",i="wysihtml5-command-active",o="wysihtml5-action-active",r=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(r,s,a){this.editor=r,this.container="string"==typeof s?document.getElementById(s):s,this.composer=r.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),a&&this.show(),null!=r.config.classNameCommandDisabled&&(t=r.config.classNameCommandDisabled),null!=r.config.classNameCommandsDisabled&&(n=r.config.classNameCommandsDisabled),null!=r.config.classNameCommandActive&&(i=r.config.classNameCommandActive),null!=r.config.classNameActionActive&&(o=r.config.classNameActionActive);for(var l=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),c=l.length,d=0;c>d;d++)new e.toolbar.Speech(this,l[d])},_getLinks:function(t){for(var n,i,o,r,s,a=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),l=a.length,c=0,d=this[t+"Mapping"]={};l>c;c++)n=a[c],o=n.getAttribute("data-wysihtml5-"+t),r=n.getAttribute("data-wysihtml5-"+t+"-value"),i=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+o+"']"),s=this._getDialog(n,o),d[o+":"+r]={link:n,group:i,name:o,value:r,dialog:s,state:!1}},_getDialog:function(t,n){var i,o,r=this,s=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']");return s&&(i=e.toolbar["Dialog_"+n]?new e.toolbar["Dialog_"+n](t,s,this.editor.config.iframe):new e.toolbar.Dialog(t,s,this.editor.config.iframe),i.on("show",function(){o=r.composer.selection.getBookmark(),r.editor.fire("show:dialog",{command:n,dialogContainer:s,commandLink:t})}),i.on("save",function(e){o&&r.composer.selection.setBookmark(o),r._execCommand(n,e),r.editor.fire("save:dialog",{command:n,dialogContainer:s,commandLink:t})}),i.on("cancel",function(){r.editor.focus(!1),r.editor.fire("cancel:dialog",{command:n,dialogContainer:s,commandLink:t})})),i},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?(n.dialog.show(),"showSource"==e&&editor.fire("showSource")):this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&t.textarea&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea"))},_observe:function(){for(var e=this,t=this.editor,i=this.container,o=this.commandLinks.concat(this.actionLinks),s=o.length,a=0;s>a;a++)"A"===o[a].nodeName?r.setAttributes({href:"javascript:;",unselectable:"on"}).on(o[a]):r.setAttributes({unselectable:"on"}).on(o[a]);r.delegate(i,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),r.delegate(i,"[data-wysihtml5-command]","mousedown",function(t){var n=this,i=n.getAttribute("data-wysihtml5-command"),o=n.getAttribute("data-wysihtml5-command-value");e.execCommand(i,o),t.preventDefault()}),r.delegate(i,"[data-wysihtml5-action]","click",function(t){var n=this.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),t.on("interaction:composer",function(){e._updateLinkStates()}),t.on("focus:composer",function(){e.bookmark=null}),t.on("change_view",function(o){t.textarea&&setTimeout(function(){e.commandsDisabled="composer"!==o,e._updateLinkStates(),e.commandsDisabled?(r.addClass(t.textarea.element,"wysihtml5-current-view-textarea"),r.addClass(i,n)):(r.removeClass(t.textarea.element,"wysihtml5-current-view-textarea"),r.removeClass(i,n))},0)})},_updateLinkStates:function(){var n,s,a,l,c=this.commandMapping,d=this.actionMapping;for(n in c)if(l=c[n],this.commandsDisabled?(s=!1,r.removeClass(l.link,i),l.group&&r.removeClass(l.group,i),l.dialog&&l.dialog.hide()):(s=this.composer.commands.state(l.name,l.value),r.removeClass(l.link,t),l.group&&r.removeClass(l.group,t)),l.state!==s)if(l.state=s,s){if("foreColorStyle"===l.name||"bgColorStyle"===l.name){var u=this.composer.commands.stateValue(l.name),h=l.link.getAttribute("data-wysihtml5-command-value");u===h?r.addClass(l.link,i):r.removeClass(l.link,i)}else r.addClass(l.link,i);l.group&&r.addClass(l.group,i),l.dialog&&("object"==typeof s||e.lang.object(s).isArray()?(!l.dialog.multiselect&&e.lang.object(s).isArray()&&(s=1===s.length?s[0]:!0,l.state=s),l.dialog.show(s)):l.dialog.hide())}else r.removeClass(l.link,i),l.group&&r.removeClass(l.group,i),l.dialog&&l.dialog.hide();for(n in d)a=d[n],"change_view"===a.name&&(a.state=this.editor.currentView===this.editor.textarea,a.state?r.addClass(a.link,o):r.removeClass(a.link,o))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){var t=e.dom;e.toolbar.toolbarCreate=function(n){var i,o=n.config,r=n.composer,s=o.noTextarea||!1,a=s?r.doc:document,l=void 0!==o.iframe?o.iframe.contentWindow:window,c=r.editableArea,d=c.offsetParent,u=c,h=o.theme,f=o.toolbar,m=!1,g="undefined"!=typeof l.FormData,p={},y={mode:{},image:{}},v=(new Date).getTime(),w=function(){p=e.language[o.locale]||e.language.en,"rtl"===n.editableElement.dir&&(y.wysiwyg.dir="rtl")},b=function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()},C=function(e){var t={fontSize:"fontSize",align:"align",forecolor:"foreColor",ol:"insertOrderedList",ul:"insertUnorderedList",hr:"insertHorizontalRule",unlink:"removeLink"};return e in t?t[e]:e},N=function(e){var t={ol:"lists",ul:"lists",indent:"lists",link:"link",unlink:"link",hr:"hr",undo:"history",redo:"history"};return e in t?p[t[e]]:p.font},E=function(t){return"insertText"===t||void 0!==e.commands[t]},x={create:function(e,t){var n=a.createElement(e);if(t)switch(Object.prototype.toString.call(t)){case"[object String]":n.textContent=t;break;case"[object Object]":n=this.setAttr(n,t)}return n},setAttr:function(e,n){for(key in n)if("[object Array]"===Object.prototype.toString.call(n[key])){var i;"class"===key&&(i=e.getAttribute("class")),
e.setAttribute(key,(i?i+" ":"")+n[key].join(" "))}else"class"===key?t.addClass(e,n[key]):"text"===key?e.textContent=n[key]:"type"!==key||"value"!==key||"style"!==key||"src"!==key||"title"!==key||"id"!==key?e.setAttribute(key,n[key]):e[key]=n[key];return e},append:function(e,t){var n=a.createDocumentFragment();if("[object Array]"===Object.prototype.toString.call(t))for(var i=0,o=t.length;o>i;i=i+1|0)n.appendChild(t[i]);else n.appendChild(t);return e.appendChild(n),e}},S=function(e){var t=e.getBoundingClientRect();return{left:t.left+(l.pageXOffset||a.documentElement.scrollLeft),top:t.top+(l.pageYOffset||a.documentElement.scrollTop)}},T={enable:function(){m=!0,t.addClass(d,"wysihtml5-box-fullscreen"),a.body.style.overflowY="hidden",this.resize(),l.scrollTo(0,0)},disable:function(){a.body.style.overflowY="auto",t.removeClass(d,"wysihtml5-box-fullscreen"),m=!1,d.removeAttribute("style"),y.mode["default"].init(),l.scrollTo(0,S(d).top),c.style.height="auto"},resize:function(){if(m){y.mode["default"].init();var e=l.innerHeight-y.wysiwyg.clientHeight;d.setAttribute("style","width: 100%; height: "+l.innerHeight+"px;"),c.style.height=e+"px"}}},R=function(t,n,i,o,r){var s=x.create("li"),a=x.create("button",{type:"button","class":e.classes.buttons.btn});return void 0!==h.icons[t]?a.appendChild(x.create("i",{"class":[h.iconPrefix,h.icons[t]],"aria-hidden":!0})):"object"==typeof t?void 0!==t.icon?a.appendChild(x.create("i",{"class":[h.iconPrefix,t.icon],"aria-hidden":!0})):a.textContent=b(t.title?t.title:i):a.textContent=b(t),n&&(o?mode="action"===o?"data-wysihtml5-action":"data-wysihtml5-command-group":mode="data-wysihtml5-command",a.setAttribute(mode,n)),i&&(a=x.setAttr(a,{"aria-label":i,"class":"wysihtml5-tooltip"})),r&&a.setAttribute("data-wysihtml5-command-value",r),s.appendChild(a),s},A=function(e,t,n,i){var r=new XMLHttpRequest;if("undefined"==typeof o.files.withCredentials||o.files.withCredentials===!0&&"withCredentials"in r)r.overrideMimeType&&r.overrideMimeType("application/json"),r.open(t,e,!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),"undefined"!=typeof o.files.securityKey&&r.setRequestHeader("X-Security-Key",o.files.securityKey),o.files.withCredentials===!0&&(r.withCredentials=!0),r.onreadystatechange=function(){4==r.readyState&&"200"==r.status&&i(r.responseText)},r.send(n);else{var s=new XDomainRequest;s.onerror=function(){i({status:"error",data:"404 Not Found"})},s.ontimeout=function(){i({status:"error",data:"Request timeout"})},s.onload=function(){i(s.responseText)},s.open(t,e),s.send(n)}};y.dialog=function(n,i,o,r,s){var a=x.create("div",{"data-wysihtml5-dialog":n}),l=x.create("div",{"class":"wysihtml5-dialog"});if(i){l.appendChild(i);var c=x.create("footer");c.innerHTML='<button tyle="button" data-wysihtml5-dialog-action="cancel" class="'+e.classes.buttons.btn+" "+e.classes.buttons.cancel+'">'+p.action.cancel+'</button><button tyle="button" data-wysihtml5-dialog-action="save" class="'+e.classes.buttons.btn+" "+e.classes.buttons.save+'">'+p.action.save+"</button>",l.appendChild(c),t.addClass(i,"content"),r&&i.insertAdjacentHTML("afterbegin",'<div class="wysihtml5-dialog-title"><h3>'+r+"</h3></div>")}return s&&a.setAttribute("data-wysihtml5-dialog-id",s),a.appendChild(l),o&&t.addClass(a,o),y.wysiwyg.appendChild(a),a},y.tabs={create:function(e,n,i){for(var o=x.create("div",{"class":["wysihtml5-tabs"]}),r=e.length,s=x.create("ul",{"class":["wysihtml5-tabs-tab",2===r?"wysihtml5-tabs-tab-two":"wysihtml5-tabs-tab-three"]}),l=x.create("li",{"class":"wysihtml5-tabs-indicator"}),c=a.createDocumentFragment(),d=0;r>d;d=d+1|0){var u=x.create("li",{text:p[i][e[d]],"class":"wysihtml5-tabs-"+e[d]});t.observe(u,"click",this.show.bind(null,d,n,l)),c.appendChild(u)}return c.appendChild(l),s.appendChild(c),x.append(o,[s,n])},show:function(e,o,r){i&&n.composer.selection.setBookmark(i);var s=a.querySelector(":focus");null!==s&&s.focus();var l=o.children,c=l.length,d=(2===c?"50":"33.333")*e;r.style.left=d+"%";for(var u=0;c>u;u=u+1|0)e==u?t.addClass(l[u],"active"):t.removeClass(l[u],"active")}},y.dropdown={init:function(e){var n=this;a.querySelector(":focus");t.observe(e,"mousedown",function(o){var s=r.selection.getBookmark();if(r.selection.setBookmark(s),o.preventDefault(),t.hasClass(y.wysiwyg,"wysihtml5-commands-disabled"))return!1;var a=o.target.parentNode;t.hasClass(a,"wysihtml5-tabs-tab")||(t.toggleClass(e,"active"),t.hasClass(e,"active")?(i=r.selection.getBookmark(),n.show(e)):i="")})},show:function(e){var n=e.parentNode.children,i=e.querySelector(".wysihtml5-dropdown-content"),o=i.clientWidth,r=y.buttons.clientWidth,s=e.offsetLeft,a="top: "+(e.offsetTop+e.clientHeight)+"px; ";a+=2>r/s?"right: "+(r-(s+e.clientWidth))+"px;":"left: "+(o>r/o&&t.hasClass(i,"wysihtml5-dropdown-color")?o/2:s)+"px;",i.setAttribute("style",a);for(var d=0,u=n.length;u>d;d=d+1|0)t.hasClass(n[d],"wysihtml5-dropdown")&&n[d]!==e&&t.removeClass(n[d],"active");"IFRAME"===c.tagName&&t.observe(c.contentWindow,"mousedown",this.hide.bind(null,e)),t.observe(l,"mousedown",this.hide.bind(null,e))},hide:function(e,n){var o=n.target;e.contains(o)||(t.removeClass(e,"active"),i="")}},y.counter={get:function(e){var t=0;if(2===o.counter){e=escape(e);for(var n=0;n<e.length;n++,t++)"%"==e.charAt(n)&&("u"==e.charAt(++n)&&(n+=3,t++),n++)}else t=e.length;return t},set:function(e){var t=r.element,n=t.innerText,i="",s=parseInt(o.limiter)||0,a=y.counter.get(n);s&&a>=s&&(i="wysihtml5-limiter-error",e&&8!=e.keyCode&&(e.keyCode==P&&t.blur(),e.preventDefault())),M.innerHTML="<span>"+a+(s>0?"/"+s:"")+"</span>",M.firstElementChild.className=i}},y.image.uploader=function(e,n){A(o.files.uploader,"POST",e,function(e){var i=JSON.parse(e);if("success"===i.status)if("undefined"!=typeof i.data.sizes){for(var o=i.data.sizes,r=i.data.images,s=y.image.preview.element(n,r[o[0]].url),l=a.createDocumentFragment(),c=x.create("p",{"class":"action"}),d=0,u=o.length;u>d;d=d+1|0){var h=o[d],f=r[h];l.appendChild(y.image.preview.button(f,s,h))}c.appendChild(l),s.appendChild(c),n.firstElementChild.style.display="none"}else y.image.setURL(i.data,t.closest(n,".wysihtml5-dialog"));else y.image.error(i.data,n.firstElementChild);t.removeClass(n,"loading")})},y.image.manager=function(n){t.hasClass(n,"loaded")||t.addClass(n,"loading"),A(o.files.manager,"GET",null,function(i){function o(){f>1&&(f--,l(f))}function r(){v>f&&(f++,l(f))}function s(t,i){var o=y.image.preview.element(n,d?t[d[0]].url:t.url),r=a.createDocumentFragment(),s=x.create("p",{"class":"action"}),c=x.create("button",{type:"button","class":[e.classes.buttons.btn,e.classes.buttons.cancel],text:p.image.back});if(r.appendChild(c),d)for(var u=0,h=d.length;h>u;u=u+1|0){var f=d[u],m=t[f];r.appendChild(y.image.preview.button(m,o,f))}else r.appendChild(y.image.preview.button(t,o));c.onclick=l.bind(null,i,o),s.appendChild(r),o.appendChild(s),w.style.display="none"}function l(e,t){var i=n.getElementsByClassName("filemanager")[0],l=i.firstElementChild,c=n.getElementsByClassName("pager-next")[0],d=n.getElementsByClassName("pager-prev")[0],h=n.getElementsByClassName("pager-pagenum")[0],f=a.createDocumentFragment();t&&(t.parentNode.removeChild(t),i.style.display="block"),1>e&&(e=1),e>v&&(e=v),l.innerHTML="";for(var p=(e-1)*m;e*m>p&&g>p;p++){var y=x.create("img",{src:u[p].preview});f.appendChild(y),y.onclick=s.bind(null,u[p],e)}l.appendChild(f),h.innerHTML=e+"/"+v,d.style.visibility=1==e?"hidden":"visible",c.style.visibility=e==v?"hidden":"visible",c.onclick=r.bind(null),d.onclick=o.bind(null)}var c=JSON.parse(i),d="undefined"!=typeof c.data.sizes?c.data.sizes:null,u=c.data.images;if("success"===c.status){var f=(t.closest(n,".wysihtml5-dialog"),1),m=20,g=u.length,v=Math.ceil(g/m),w=n.getElementsByClassName("filemanager")[0];if(!w){var w=x.create("div",{"class":"filemanager"});w.innerHTML='<p class="filemanager-list"></p><ul class="pager clearfix"><li class="pager-prev"><i class="'+h.iconPrefix+" "+h.icons.prev+'" aria-hidden="true"></i><li><li class="pager-next"><i class="'+h.iconPrefix+" "+h.icons.next+'" aria-hidden="true"></i><li><li class="pager-pagenum"></li></ul>',n.appendChild(w)}l(1)}else y.image.error(c.data,n);t.hasClass(n,"loading")&&(t.removeClass(n,"loading"),t.addClass(n,"loaded"))})},y.image.preview={element:function(n,i){var o=x.create("div",{"class":"image-preview"}),r=x.create("img",{src:i,"class":e.classes.responsive});return n.appendChild(o),o.appendChild(r),t.addClass(o,"active"),o},button:function(n,i,o){var r=t.closest(i,".wysihtml5-dialog"),s=x.create("button",{type:"button","class":[e.classes.buttons.btn,e.classes.buttons.choose,"wysihtml5-tooltip"],text:o?b(o):p.image.choose,"aria-label":n.width+" x "+n.height});return s.onclick=y.image.setURL.bind(null,{title:n.title,url:n.url,width:n.width,height:n.height},r,i),s}},y.image.calc=function(e,i){function o(){r(function(e){for(var n=0,i=c.length;i>n;n=n+1|0)t.observe(c[n],"keyup",function(){if(u&&t.hasClass(a,d)){var n=this.getAttribute("data-wysihtml5-dialog-field"),i="width"===n?1:0;c[i].value=Math.round(this.value*e[n])}})})}function r(e){var t=new Image;t.src=u,t.onload=function(){e({width:this.height/this.width,height:this.width/this.height})}}var s=e.getElementsByClassName("wysihtml5-image-dimension-opt")[0],a=e.getElementsByClassName("wysihtml5-image-dimensions")[0],l=e.getElementsByClassName("imageurl")[0],c=a.querySelectorAll("input"),d="wysihtml5-image-proportion-locked",u=l.value;s.onclick=function(){t.toggleClass(a,d),this.firstElementChild.className=i.iconPrefix+" "+(t.hasClass(a,d)?i.icons.lock:i.icons.unlock)},n.on("change:image",function(e){u=e.url,o()}),o()},y.image.error=function(t,n){var i=x.create("span",{text:t,"class":e.classes.error});n.appendChild(i),setTimeout(function(){i.parentNode.removeChild(i)},3e3)},y.image.setURL=function(e,i,o){for(var r=i.querySelector(".imageurl"),s=i.querySelector(".alt"),a=i.querySelector('input[data-wysihtml5-dialog-field="width"]'),l=i.querySelector('input[data-wysihtml5-dialog-field="height"]'),c=(i.getElementsByClassName("wysihtml5-tabs-tab"),i.querySelector(".wysihtml5-tabs-contents")),d=c.children,u=i.querySelector(".wysihtml5-tabs-indicator"),h=0,f=d.length;f>h;h=h+1|0)t.removeClass(d[h],"active"),0===h&&t.addClass(d[h],"active");o&&(o.previousElementSibling.style.display="block",o.parentNode.removeChild(o)),u.style.left=0,r.focus(),"object"==typeof e?(e.title&&(s.value=e.title),e.width&&(a.value=e.width),e.height&&(l.value=e.height),r.value=e.url):r.value=e,n.fire("change:image",{url:"object"==typeof e?e.url:e})},y.mode["default"]={init:function(){t.addClass(y.wysiwyg,"wysihtml5-toolbar-textarea"),y.buttons.setAttribute("style","width: "+u.offsetWidth+"px; visibility: visible;"),t.observe(l,"resize",this.resize.bind(this)),t.observe(l,"scroll",this.scroll.bind(this))},resize:function(){y.buttons.setAttribute("style","width: "+u.offsetWidth+"px")},scroll:function(){if(t.hasClass(y.wysiwyg,"wysihtml5-commands-disabled")||m)t.removeClass(e,"sticky"),e.style.visibility="visible";else{var e=y.buttons,n=S(u),i=u.clientHeight,o=y.buttons.clientHeight;l.pageYOffset>n.top&&l.pageYOffset<n.top+i?(t.addClass(e,"sticky"),e.style.visibility="visible"):l.pageYOffset>n.top+i-o?(t.removeClass(e,"sticky"),e.style.visibility="hidden"):(t.removeClass(e,"sticky"),e.style.visibility="visible")}}},y.mode.air=function(n){if(t.closest(n.target,"."+e.classes.uneditableContainerClassname))t.removeClass(y.buttons,"active");else var i=setInterval(function(){for(var e=document.getElementsByClassName("wysihtml5-toolbar"),o=0,r=e.length;r>o;o=o+1|0)e[o]!==y.wysiwyg&&t.hasClass(y.buttons,"active")&&t.removeClass(y.buttons,"active");var s=a.body.clientWidth,c=y.wysiwyg.firstElementChild.scrollWidth,d=c/2,u=n.pageX-d,h=n.pageY,f=h-l.pageYOffset>80?h-80:h+60,m=0>=u?10:s<=n.pageX+d?s-c-5:u;y.buttons=x.setAttr(y.buttons,{style:"top: "+f+"px; left: "+m+"px;","class":"active"}),clearInterval(i)},200)},y.blur=function(e){var n=e.relatedTarget;n?y.wysiwyg!==t.closest(n,".wysihtml5-toolbar")&&t.removeClass(y.buttons,"active"):t.removeClass(y.buttons,"active")},y.set={block:function(){t.addClass(this.drops(R("style",null,p.style.style),null,f.groupBlock,"block"),"wysihtml5-dropdown-block")},inline:function(){t.addClass(this.drops(R("inline",null,p.font.title),"inline",f.groupInline,"inline",p.font),"wysihtml5-dropdown-inline")},lists:function(){t.addClass(this.drops(R("ul",null,p.lists.lists),null,["ul","ol","indent"],"command",p.lists),"wysihtml5-dropdown-lists")},fontSize:function(){t.addClass(this.drops(R("fontSize",null,p.font.size),"fontSize",e.classes.size_font,"class"),"wysihtml5-dropdown-fontsize")},align:function(){t.addClass(this.drops(R("alignCenter",null,p.align.align),"align",e.classes.align_text,"command",p.align),"wysihtml5-dropdown-align")},foreColor:function(){t.addClass(this.drops(R("foreColor",null,p.font.fore),"foreColor",e.classes.foreColor,"class"),"wysihtml5-dropdown-forecolor")},styles:function(e){var n=o.addStyles[e];if(!n.command)throw new Error("addStyles."+e+".command is required.");if("inlineStyle"!==n.command&&"blockStyle"!==n.command)throw new Error("addStyles."+e+".command ("+n.command+") is not supported.");if(!n.icon&&!n.title)throw new Error("addStyles."+e+' "title" or "icon" is required.');t.addClass(this.drops(R(n,null,n.title),n.command,n.options,"style",e),"wysihtml5-dropdown-"+e.toLowerCase())},drops:function(n,i,o,r,s){var l=x.create("ul",{"class":"wysihtml5-dropdown-content"}),c=content=x.create("li"),d=a.createDocumentFragment(),u=0;return n=x.setAttr(n,{"class":"wysihtml5-dropdown"}),("inline"===r||s&&(void 0!==s.ul||void 0!==s.align))&&t.addClass(l,"wysihtml5-dropdown-with-icon"),i&&n.firstElementChild.setAttribute("data-wysihtml5-command-group",i),y.buttons.appendChild(n),Object.keys(o).forEach(function(n){var a=c.cloneNode(),l="";if("REG_EXP"!==n){var f=o[n];if("class"===r)l='<span class="'+f+'" data-wysihtml5-command="'+i+'" data-wysihtml5-command-value="'+n+'">'+n+"</span>";else if("style"===r)l='<span class="'+f+'" data-wysihtml5-command="'+i+'" data-wysihtml5-command-value="'+s+":"+n+'">'+n+"</span>",t.addClass(a,"wysihtml5-style-list");else if("inline"===r){var m='<i class="'+h.iconPrefix+" "+h.icons[f]+'"></i>',g=' data-wysihtml5-command="inline" data-wysihtml5-command-value="'+f+'"';l='<span class="'+e.classes.align_text.alignCenter+' wysihtml5-tooltip"'+g+'" aria-label="'+s[f]+'">'+m+"</span>"}else if("block"===r){var g;g="blockquote"===f?' data-wysihtml5-command="insertBlockQuote"':' data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="'+f+'"',l="<"+f+g+">"+p.style[f]+"</"+f+">"}else if("command"===r){var m=h.icons[i?n:f],y="undefined"!=typeof m?'<i class="'+h.iconPrefix+" "+m+'"></i>':n,g='data-wysihtml5-command="'+(i?i+'" data-wysihtml5-command-value="'+("insertHTML"===i||"insertText"===i?f.replace(/"/g,"'"):C(n))+'"':C(f))+'"',v=s?' aria-label="'+("undefined"!=typeof s[f]?s[f]:s[n])+'"':"",w="insertHTML"===i?"wysihtml5-template-list"+(u+1):e.classes.align_text.alignCenter;g=s?'class="'+e.classes.align_text.alignCenter+' wysihtml5-tooltip" '+g:g,l="<span "+g+v+">"+y+"</span>",a.className=w}a.innerHTML=l,d.appendChild(a)}u++}),l.appendChild(d),n.appendChild(l),y.dropdown.init(n),l},add:function(n){var i=o.addButtons[n];if(!i.command)throw new Error("addButton."+n+".command is required.");if(!E(i.command))throw new Error("addButton."+n+".command ("+i.command+") is not supported.");if(!i.icon&&!i.title)throw new Error("addButton."+n+' "title" or "icon" is required.');"insertText"!==i.command||e.browser.supportsCommand(a,"insertText")||(i.command="insertHTML");var r=void 0!==i.options?i.options:!1,s=R(i,r?null:i.command,i.title,null,i.value);if(r)t.addClass(this.drops(s,i.command,r,"command"),"wysihtml5-dropdown-"+n.toLowerCase());else if("undefined"!=typeof i.dialog){var l=x.create("div");l.innerHTML=i.dialog,y.dialog(i.command,l)}y.buttons.appendChild(s)},btn:function(e){var t=N(e),n=["bold","italic","underline","strikethrough","superscript","subscript"].indexOf(e)>=0;y.buttons.appendChild(R(e,n?"inline":C(e),"string"==typeof t?t:t[e],null,n?e:null))},img:function(){var i,r=R("image","insertImage",p.image.image),s=v.toString().substr(-2),a=p.image,l="",c=x.create("div");if(y.buttons.appendChild(r),l='<input type="url" value="" class="imageurl" data-wysihtml5-dialog-field="src" placeholder="'+a.url+'"><input type="text" class="alt" data-wysihtml5-dialog-field="alt" placeholder="'+a.placeholder+'"><div class="wysihtml5-selectbox"><select data-wysihtml5-dialog-field="className"><option value="">'+a.floatNone+"</option>",Object.keys(e.classes.image["float"]).forEach(function(e){"REG_EXP"!==e&&(l+='<option value="'+e+'">'+a["float"+e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()]+"</option>")}),l+='</select></div><div class="wysihtml5-image-dimensions wysihtml5-image-proportion-locked"><label>'+a.dimensions+'</label><input type="number" data-wysihtml5-dialog-field="width" value="" min="1"> x <input type="number" data-wysihtml5-dialog-field="height" value="" min="1"><div class="wysihtml5-image-dimension-opt wysihtml5-tooltip" aria-label="'+a.proportion+'"><i class="'+h.iconPrefix+" "+h.icons.lock+'"></i></div></div><div class="labeled"><input type="checkbox" value="'+e.classes.image.responsive+'" data-wysihtml5-dialog-field="className" id="iresp'+s+'" min="1"><label for="iresp'+s+'">'+p.responsive+'</label></div><div class="wysihtml5-image-link"><label for="icap'+s+'">'+a.caption+'</label><input type="text" id="icap'+s+'" data-wysihtml5-dialog-field="caption"><label for="iurl'+s+'">'+a.link+'</label><input type="url" id="iurl'+s+'" data-wysihtml5-dialog-field="href"><div class="labeled"><input type="checkbox" id="ihref'+s+'" name="target" data-wysihtml5-dialog-field="target" value="_blank"><label for="ihref'+s+'">'+p.link.openInNewWindow+"</label></div></div>",c.innerHTML=l,n.on("show:dialog",function(e){"insertImage"===e.command&&y.image.calc(c,h)}),void 0!==o.files.uploader||void 0!==o.files.manager){var d=["url"],u=x.create("div",{"class":"wysihtml5-tabs-contents"});if(t.addClass(c,"active"),u.appendChild(c),void 0!==o.files.uploader){var f=x.create("div"),m=x.create("form",{"class":"wysihtml5-uploader"}),w=x.create("input",{type:"file",accept:"image/*","data-wysihtml5-dialog-field":"file"});d.push(["upload"]),m.innerHTML='<span class="wysihtml5-uploader-icon"></span><p>'+a.selectFromFiles+"</p>",m.appendChild(w),f.appendChild(m),u.appendChild(f),t.observe(w,"change",function(){if(t.addClass(f,"loading"),g){var e=this.files[0],n=new FormData;!e.type||e.type.match("image.*")?(n.append("image",e),this.value="",y.image.uploader(n,f)):(t.removeClass(f,"loading"),y.image.error(a.uploadError,m))}else t.removeClass(f,"loading"),y.image.error("Sorry! Uploader does not work on IE9-.",m);m.reset()})}if(void 0!==o.files.manager){var b=x.create("div");d.push(["manager"]),u.appendChild(b)}i=y.tabs.create(d,u,"image"),t.delegate(i,".wysihtml5-tabs-manager","click",function(){y.image.manager(b)})}else i=c;y.dialog("insertImage",i,null,a.insert,s)},video:function(){y.buttons.appendChild(R("video","insertVideo",p.video.insert));var t="video"+v.toString().substr(-3),n=x.create("div");n.innerHTML='<input type="url" data-wysihtml5-dialog-field="url" placeholder="'+p.video.providers+'"><div class="labeled"><input type="checkbox" value="'+e.classes.video.responsive+'" data-wysihtml5-dialog-field="className" id="'+t+'"><label for="'+t+'">'+p.responsive+"</label></div>",y.dialog("insertVideo",n,null,p.video.insert)},table:function(){var t="res"+v.toString().substr(-3),i=R("table",null,p.table.table),i=x.setAttr(i,{"class":"wysihtml5-dropdown"}),o=x.create("ul",{"class":["wysihtml5-dropdown-content","wysihtml5-dropdown-table"]}),r=x.create("div"),s="",a=p.table;y.buttons.appendChild(i),o.innerHTML='<li class="wysihtml5-table-create" aria-disabled="false"><span data-wysihtml5-command="createTable">'+a.table+'</span></li><li class="wysihtml5-table-tools" aria-disabled="true"><span data-wysihtml5-command="addTableCells" data-wysihtml5-command-value="above">'+a.addRowAbove+'</span></li><li class="wysihtml5-table-tools" aria-disabled="true"><span data-wysihtml5-command="addTableCells" data-wysihtml5-command-value="below">'+a.addRowBelow+'</span></li><li class="wysihtml5-table-tools" aria-disabled="true"><span data-wysihtml5-command="addTableCells" data-wysihtml5-command-value="before">'+a.addColLeft+'</span></li><li class="wysihtml5-table-tools" aria-disabled="true"><span data-wysihtml5-command="addTableCells" data-wysihtml5-command-value="after">'+a.addColRight+'</span></li><li class="wysihtml5-table-tools" aria-disabled="true"><span data-wysihtml5-command="deleteTableCells" data-wysihtml5-command-value="row">'+a.deleteRow+'</span></li><li class="wysihtml5-table-tools" aria-disabled="true"><span data-wysihtml5-command="deleteTableCells" data-wysihtml5-command-value="column">'+a.deleteCol+'</span></li><li class="wysihtml5-table-tools" aria-disabled="true"><span data-wysihtml5-command="mergeTableCells">'+a.merge+"</span></li>",i.appendChild(o),y.dropdown.init(i);var l=this;n.on("tableselect:composer",function(){l.tdSelect(o,i,!0)}),n.on("tableunselect:composer",function(){l.tdSelect(o,i)});for(var c=["rows","cols"],d=e.classes.table.classes,u=0,h=c.length;h>u;u=u+1|0){var f=c[u];s+='<div class="wysihtml5-table-cell"><label>'+a[f]+'</label><input type="number" data-wysihtml5-dialog-field="'+f+'" value="3" min="1"></div>'}s+='<div class="wysihtml5-selectbox"><select data-wysihtml5-dialog-field="style"><option value="" selected="selected">-- '+a.style+" --</option>";for(key in d)s+='<option value="'+d[key]+'">'+key+"</option>";s+="</select></div>",s+='<div class="labeled"><input type="checkbox" value="'+e.classes.table.responsive+'" data-wysihtml5-dialog-field="className" id="'+t+'"><label for="'+t+'">'+p.responsive+"</label></div>",r.innerHTML=s,y.dialog("createTable",r,null,p.table.table)},tdSelect:function(e,n,i){var o=e.getElementsByClassName("wysihtml5-table-tools"),r=e.querySelector(".wysihtml5-table-create");i?t.addClass(n.firstElementChild,"wysihtml5-command-active"):t.removeClass(n.firstElementChild,"wysihtml5-command-active"),r.setAttribute("aria-disabled",i),[].forEach.call(o,function(e){e.setAttribute("aria-disabled",i?"":!0)})},colors:function(){var e=R("colors",null,p.color.color),n=x.create("ul",{"class":["wysihtml5-dropdown-content","wysihtml5-dropdown-color"]}),i=o.colors,r=x.create("li"),s=x.create("div",{"class":"wysihtml5-tabs-contents"}),l=["fore","bg"],c=a.createDocumentFragment();e=x.setAttr(e,{"class":"wysihtml5-dropdown"}),y.buttons.appendChild(e);for(var d=0;2>d;d=d+1|0){for(var u=x.create("div",{"class":"tab-"+l[d]+"ColorStyle"}),h="",f=0,m=i.length;m>f;f=f+1|0){var g="rgb("+i[f]+")",v=l[d]+"ColorStyle",w="background-color: "+g+";";h+='<a style="'+w+'" data-wysihtml5-command="'+v+'" data-wysihtml5-command-value="'+g+'" title="'+i[f]+'"></a>'}u.innerHTML=h,1>d&&t.addClass(u,"active"),c.appendChild(u)}s.appendChild(c),r.appendChild(y.tabs.create(l,s,"color")),n.appendChild(r),e.appendChild(n),y.dropdown.init(e)},link:function(){y.buttons.appendChild(R("link","createLink",p.link.link));var e="target"+v.toString().substr(-2),t=x.create("div");t.innerHTML='<input type="url" data-wysihtml5-dialog-field="href" placeholder="'+p.link.url+'"><div class="labeled"><input type="checkbox" id="'+e+'" name="target" data-wysihtml5-dialog-field="target" value="_blank"><label for="'+e+'">'+p.link.openInNewWindow+"</label></div>",y.dialog("createLink",t,null,p.link.link)},fullscreen:function(){if(!s){var e=R("fullscreen",null,p.fullscreen),n=e.getElementsByTagName("i")[0],i="wysihtml5-command-active";t.observe(e.firstElementChild,"click",function(){return t.hasClass(y.wysiwyg,"wysihtml5-commands-disabled")?!1:(t.toggleClass(this,i),t.hasClass(this,i)?(n.className=n.className.replace(h.icons.fullscreen,h.icons.normalscreen),T.enable()):(T.disable(),n.className=n.className.replace(h.icons.normalscreen,h.icons.fullscreen)),void t.observe(l,"resize",function(){T.resize()}))}),y.buttons.appendChild(e)}},html:function(){var i;if(s){i=R("html","showSource",p.codeview),i.setAttribute("data-wysihtml5-action","showSource");var o=x.create("div"),r=x.create("textarea",{"class":[e.classes.textareaClassName,"wysihtml5-current-view-textarea"]});o.appendChild(r),dialog=y.dialog("showSource",o,"sourcecode"),n.on("showSource",function(){r.value=n.getValue()}),t.delegate(dialog,'[data-wysihtml5-dialog-action="save"]',"click",function(e){n.setValue(r.value),r.value="",e.preventDefault()})}else i=R("html","change_view",p.codeview,"action"),n.on("change_view",function(e){u="composer"!==e?this.editableElement:c});y.buttons.appendChild(i)}},y.wysiwyg=x.create("div",{"class":"wysihtml5-toolbar"}),y.buttons=x.create("ul",{"class":"wysihtml5-toolbar-buttons"}),y.wysiwyg.appendChild(y.buttons),void 0!==h.color&&t.addClass(y.wysiwyg,"wysihtml5-toolbar-color-"+h.color),w();for(var _=["bold","italic","underline","strikethrough","superscript","subscript","indent","ol","ul","unlink","hr","undo","redo"],k=0,L=f.button,I=L.length;I>k;k=k+1|0){var O=L[k];try{if(_.indexOf(O)>=0)y.set.btn(O);else if("undefined"!=typeof o.addStyles&&"object"==typeof o.addStyles[O])y.set.styles(O);else if("undefined"!=typeof o.addButtons&&"object"==typeof o.addButtons[O])y.set.add(O);else if(f["group"+b(O)])y.set[O]?y.set[O]():y.set.group(O);else{if("function"!=typeof y.set[O])throw new Error('"'+O+'" is not a toolbar function. Please check it out your configuration of "toolbar.button".');y.set[O]()}}catch(D){l.console.log(D)}}if(s)t.addClass(y.wysiwyg,"wysihtml5-toolbar-air"),t.observe(c,"click",y.mode.air),n.on("blur",y.blur),a.body.appendChild(y.wysiwyg,c);else if(y.mode["default"].init(),n.editableElement.parentNode.insertBefore(y.wysiwyg,n.editableElement),o.counter){var M=x.create("div",{"class":"wysihtml5-text-counter"}),P=e.browser.isGecko?13:229;d.appendChild(M),t.observe(r.element,["keydown","paste","keyup","keypress"],y.counter.set),y.counter.set()}return n.on("disable:composer",function(){y.wysiwyg.setAttribute("disabled",!0)}),n.on("enable:composer",function(){y.wysiwyg.removeAttribute("disabled")}),y.wysiwyg}}(wysihtml5),wysihtml5.language.en={font:{title:"Text Formatting",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript",size:"Font Size"},styles:{inlineStyle:"Inline style",blockStyle:"Block style"},image:{image:"Picture",insert:"Insert Image",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",dimensions:"Dimensions",proportion:"Constrain proportions",selectFromFiles:"Select from files",manager:"Manager",upload:"Upload",uploadError:"Accept only image files",placeholder:"An image with an alternate text specified",caption:"Caption",link:"Link",url:"From URL",choose:"Choose",back:"Back"},video:{insert:"Insert Video",providers:"(YouTube, Vimeo, Instagram, DailyMotion)"},link:{link:"Link",unlink:"Unlink",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Create table",style:"Table style",rows:"Rows",cols:"Columns",merge:"Merge cells",addRowAbove:"Insert row above",addRowBelow:"Insert row below",addColLeft:"Insert column left",addColRight:"Insert column right",deleteRow:"Delete row",deleteCol:"Delete column"},style:{style:"Style",p:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{lists:"Lists",ul:"Unordered list",ol:"Ordered list",indent:"Indent"},align:{align:"Alignment",alignLeft:"Align left",alignCenter:"Align center",alignRight:"Align right",alignJustify:"Justify full"},color:{color:"Color",bg:"Background",fore:"Foreground"},hr:"Insert Horizontal Rule",action:{save:"Ok",cancel:"Cancel"},history:{undo:"Undo",redo:"Redo"},responsive:"Responsive",fullscreen:"Fullscreen",codeview:"Code View"};